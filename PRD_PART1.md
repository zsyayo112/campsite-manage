# 长白山营地旅游管理系统 - 产品需求文档 (Part 1)

**版本**: V2.0 (增强版)  
**日期**: 2026年1月9日  
**状态**: 待开发

> 💡 **提示**: 本文档较长，已分为两部分。Part 2包含完整的数据库Schema、附录和参考资料。

---

## 📑 快速导航

- **核心模块**: [用户认证](#4-用户认证模块) | [客户管理](#5-客户管理模块) | [订单管理](#6-订单管理模块)
- **新增模块**: [住宿管理](#7-住宿管理模块) | [接送调度](#8-接送调度模块) | [套餐管理](#9-套餐管理模块) | [行程排期](#10-行程排期模块)
- **⭐ 客户自助预约**: [客户预约表单](#13-客户自助预约模块)
- **辅助模块**: [内容管理](#11-内容管理模块) | [统计分析](#12-统计分析模块)
- **开发指南**: [技术架构](#14-技术架构) | [开发计划](#15-开发计划)

---

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 长白山营地旅游管理系统产品需求文档 |
| 文档版本 | V2.0（增强版） |
| 更新日期 | 2026年1月9日 |
| 项目名称 | 长白山营地旅游管理系统 |
| 项目特色 | ⭐ 住宿管理 ⭐ 接送调度 ⭐ 套餐组合 ⭐ 行程排期 |
| 目标用户 | 营地运营管理人员、司机、活动教练 |

### 1.1 版本更新说明

**V2.0 新增功能：**
- ✅ **住宿类型管理**：区分自营宾馆和外部住宿
- ✅ **接送调度系统**：每日人数统计、车辆安排、线路规划
- ✅ **套餐管理系统**：灵活组合项目、多种套餐方案
- ✅ **行程排期系统**：每日时间表、项目时段安排、团队协调
- ✅ **长白山营销素材**：景区特色、季节推广、游记模板

**V2.1 新增功能：**
- ⭐ **客户自助预约系统**：微信分享表单、客户自助填写、自动录入订单

---

## 2. 产品概述

### 2.1 产品背景

本营地位于**长白山旅游区**，提供独特的冬季户外体验项目。

#### 业务特点

- **客源多样**：既有住在自营宾馆的客人，也有住在小镇其他酒店的游客
- **需要接送**：每日需统计参与人数，安排大巴车往返接送
- **套餐灵活**：客人可单选项目，也可选择多项目组合
- **时间协调**：需合理安排各项目时间段，支持游学团队等大型活动
- **季节特色**：冬季主推冰雪项目，结合长白山景区特色

#### 现有痛点

- ❌ 无法准确统计每日出发人数和住宿分布
- ❌ 套餐组合依靠手工记录，容易出错
- ❌ 项目时间安排凭经验，无系统化排期
- ❌ 营销内容散乱，未充分利用长白山品牌
- ❌ **微信沟通下单效率低**，需要人工整理客户信息录入系统

### 2.2 核心业务场景

#### 场景1：散客预订 👤

```
客人小红书看到推广 → 选择"石板烧烤+冰钓" → 住"长白山大酒店"
  ↓
系统记录信息 → 活动当天统计接送人数 → 安排车辆 → 司机接客
```

#### 场景2：游学团队 👥

```
学校预订50人 → 选择全套项目 → 住自营宾馆
  ↓
系统生成行程表:
  9:00  出发
  10:00-12:00  冰钓
  12:00-14:00  午餐烧烤
  14:00-16:00  雪上滑梯
  16:00  返回
  ↓
教练根据行程准备，避免冲突
```

#### 场景3：多批次接送 🚌

```
当天3批客人:
  A酒店 10人(9:00)
  B宾馆 8人(9:30)
  自营宾馆 15人(10:00)
  ↓
系统生成方案:
  车辆1 → A酒店
  车辆2 → B宾馆 → 自营宾馆
```

#### 场景4：微信客户自助预约 📱 ⭐新增

```
典型微信对话:
  营地: 发送活动介绍和价格
  客人: "1月29日，二道白河喆啡酒店，徐迅，13821213861，两个人"
  ↓
传统流程(低效):
  运营手动整理 → 复制到Excel → 再录入系统
  ↓
新流程(自动化):
  营地: 发送预约链接
  客人: 打开表单 → 填写信息 → 提交
  系统: 自动创建客户 → 自动创建订单 → 通知运营
```

### 2.3 冬季项目清单

| 项目 | 时长 | 人数 | 特色 | 价格 |
|------|------|------|------|------|
| 🔥 石板烧烤 | 2h | 10-50人 | 长白山特色石板烤肉 | ¥98/人 |
| ⛷️ 雪上滑梯乐园 | 1.5h | 不限 | 多条滑道，全家欢 | ¥68/人 |
| 🎣 冰钓体验 | 2h | 5-30人 | 专业教练指导 | ¥128/人 |
| 🌲 冬日丛林穿越 | 1h | 10-30人 | 探索雪森林、赏雾凇 | ¥88/人 |
| 🍬 烤棉花糖 | 30min | 不限 | 篝火旁互动 | ¥20/人 |
| 🍠 烤地瓜 | 30min | 不限 | 传统美食 | ¥15/人 |

---

## 3. 功能架构

### 3.1 系统架构图

```
长白山营地管理系统
│
├── 🔐 用户认证
│   ├── 登录/登出
│   ├── 多角色(管理员/司机/教练)
│   └── 权限控制
│
├── 👥 客户管理 (CRM)
│   ├── 客户档案
│   ├── 标签分类
│   └── 消费统计
│
├── 📋 订单管理
│   ├── 订单CRUD
│   ├── 状态流转
│   └── 项目配置
│
├── 🏨 住宿管理 ⭐新增
│   ├── 地点配置
│   ├── 类型区分(自营/外部)
│   └── 分布统计
│
├── 🚌 接送调度 ⭐新增
│   ├── 人数统计
│   ├── 车辆管理
│   ├── 路线规划
│   └── 接送单生成
│
├── 🎁 套餐管理 ⭐新增
│   ├── 套餐配置
│   ├── 价格策略
│   └── 灵活组合
│
├── 📅 行程排期 ⭐新增
│   ├── 时间表
│   ├── 冲突检测
│   ├── 教练安排
│   └── 容量控制
│
├── 📱 客户自助预约 ⭐V2.1新增
│   ├── 公开预约表单
│   ├── 套餐选择
│   ├── 自动创建客户/订单
│   ├── 预约记录管理
│   └── 微信分享支持
│
├── 📝 内容管理
│   ├── 小红书笔记
│   ├── 数据统计
│   └── 发布计划
│
└── 📊 统计分析
    ├── 仪表盘
    ├── 详细报表
    └── 数据导出
```

### 3.2 功能优先级

| 优先级 | 功能 | 预计时间 | 状态 |
|-------|------|---------|------|
| **P0** | 用户认证 + 客户管理 + 订单管理 | Week 1-2 | ⏳ |
| **P0** | 住宿管理 + 基础套餐 | Week 2 | ⏳ |
| **P1** | 接送调度 + 车辆管理 | Week 3 | ⏳ |
| **P1** | 套餐管理完整 + 基础排期 | Week 4 | ⏳ |
| **P2** | 行程排期完整 + 统计分析 | Week 5-6 | ⏳ |
| **P1** | 客户自助预约系统 | Week 4-5 | ⏳ |
| **P3** | 司机端/教练端 App | Week 7-9 | ⏳ |

---

## 4-13. 详细功能需求

> 📌 **说明**: 以下各模块的详细需求包含：
> - 功能描述
> - 详细需求列表
> - 界面设计
> - 交互流程
> - 数据字典
> - 开发状态追踪

由于篇幅原因，各模块详细内容请参考原完整PRD文档（Word版）或查看代码库中的模块开发文档。

### 核心要点速查

**4. 用户认证**
- JWT Token认证
- 5种角色权限
- 状态: ⏳ 待开发

**5. 客户管理**  
- 客户列表/详情/编辑
- 标签系统(VIP/复购/意向等)
- 自动统计消费和访问
- 状态: ⏳ 待开发

**6. 订单管理**
- 订单号规则: ORD{YYYYMMDD}{序号}
- 4种状态: pending → confirmed → completed
- 关联客户、住宿、套餐
- 状态: ⏳ 待开发

**7. 住宿管理** ⭐
- 预设: 自营宾馆、长白山度假村、万达、二道白河
- 记录距离和车程
- 状态: ⏳ 待开发

**8. 接送调度** ⭐
- 按日期+住宿地点统计人数
- 车辆/司机管理
- 生成接送单(路线+客人名单)
- 状态追踪: 待出发→接送中→已完成
- 状态: ⏳ 待开发

**9. 套餐管理** ⭐
- 预设6种套餐(单项/双项/冰雪/美食/全景/团队)
- 支持自由组合
- 智能价格计算
- 状态: ⏳ 待开发

**10. 行程排期** ⭐
- 时间轴视图(8:00-18:00)
- 项目时段分配
- 4类冲突检测(场地/教练/时间/车辆)
- 教练管理
- 状态: ⏳ 待开发

**11. 内容管理**
- 小红书笔记CRUD
- 数据统计(浏览/点赞/评论/收藏)
- 发布计划日历
- 状态: ⏳ 待开发

**12. 统计分析**
- 4个核心指标卡片
- 4类可视化图表
- 多维度报表
- Excel/CSV导出
- 状态: ⏳ 待开发

**13. 长白山营销**
- 景区特色标签
- 季节营销策略
- 营销模板库
- 状态: ⏳ 待开发

---

## 13. 客户自助预约模块 ⭐V2.1新增

### 13.1 模块概述

#### 业务背景

目前营地通过微信与客户沟通预订，典型对话流程：

```
营地发送活动介绍：
"包括二道白河镇接送，包括午餐石板烧烤，包括原始凿冰钓鱼、森林轻徒步、
松针熏鱼、小鹿陪同等很多活动，开心玩一天...
姓名、电话，人数、酒店位置发我，费用298/人，四岁以下238/人..."

客户回复：
"1月29日，二道白河喆啡酒店，徐迅，13821213861，两个人"

运营人员需要：
1. 从微信聊天中提取信息
2. 手动录入客户资料
3. 手动创建订单
4. 计算金额并回复确认信息
```

**痛点分析：**
- ❌ 人工提取信息容易出错（姓名、电话、日期等）
- ❌ 高峰期消息多，处理不及时
- ❌ 信息格式不统一，增加整理难度
- ❌ 无法追踪预约状态
- ❌ 重复劳动，效率低下

#### 解决方案

提供**客户自助预约表单**，客户通过微信分享的链接填写预约信息，系统自动：
1. 创建/更新客户档案
2. 创建预约订单
3. 计算费用
4. 生成确认信息

### 13.2 功能需求

#### 13.2.1 公开预约表单页面

**页面特点：**
- 🔓 **无需登录**：客户可直接访问填写
- 📱 **移动端优先**：适配微信内置浏览器
- 🎨 **简洁美观**：突出长白山营地品牌
- ⚡ **快速加载**：优化首屏加载速度

**表单字段：**

| 字段 | 类型 | 必填 | 说明 | 验证规则 |
|------|------|------|------|---------|
| 姓名 | 文本 | ✅ | 预约人姓名 | 2-20字符 |
| 手机号 | 文本 | ✅ | 联系电话 | 11位手机号格式 |
| 微信号 | 文本 | ❌ | 微信联系方式 | - |
| 预约日期 | 日期 | ✅ | 活动日期 | 不早于明天 |
| 人数 | 数字 | ✅ | 参与人数 | 1-50人 |
| 儿童人数 | 数字 | ❌ | 4岁以下儿童 | 0-人数 |
| 酒店名称 | 下拉/文本 | ✅ | 住宿地点 | 支持自定义输入 |
| 房间号 | 文本 | ❌ | 方便接送联系 | - |
| 套餐选择 | 单选 | ✅ | 选择活动套餐 | 从可用套餐中选择 |
| 备注 | 文本域 | ❌ | 特殊需求说明 | 最多500字 |

**酒店选项预设：**
```
- 喆啡酒店（二道白河）
- 长白山国际度假村
- 万达度假区酒店
- 营地自营宾馆
- 其他（请填写）
```

**套餐选项（从系统读取）：**
```
- 双溪森林营地全天套餐 - ¥298/人（儿童¥238）
- 冰雪乐园半日套餐 - ¥198/人
- 石板烧烤单项体验 - ¥98/人
- 其他（联系客服定制）
```

**特殊日期价格提示：**
```
⚠️ 初二到初六(2026-01-30至2026-02-03)为春节特别档期
价格调整为：成人358元/人，儿童298元/人
```

#### 13.2.2 预约提交流程

```
┌─────────────────────────────────────────────────────────┐
│                    客户填写表单                          │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    前端表单验证                          │
│  - 必填字段检查                                          │
│  - 手机号格式验证                                        │
│  - 日期合理性验证                                        │
│  - 人数范围验证                                          │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    提交到后端API                         │
│  POST /api/public/bookings                              │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    后端处理逻辑                          │
│  1. 验证数据完整性                                       │
│  2. 检查手机号是否已存在客户                             │
│     - 存在: 更新客户信息                                 │
│     - 不存在: 创建新客户                                 │
│  3. 创建预约记录(Booking)                               │
│  4. 计算预估金额                                         │
│  5. 生成预约确认码                                       │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    返回确认页面                          │
│  - 预约确认码                                            │
│  - 预约详情摘要                                          │
│  - 预估费用明细                                          │
│  - 联系方式和注意事项                                    │
│  - 可复制的确认信息文本                                  │
└─────────────────────────────────────────────────────────┘
```

#### 13.2.3 预约确认页面

**显示内容：**

```
✅ 预约提交成功！

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
预约确认码: BK20260129001
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 预约信息
───────────────────────────────
日期：2026-01-29（周四）
姓名：徐迅
电话：138****3861
人数：2人（成人2人）
酒店：喆啡酒店
套餐：双溪森林营地全天套餐

💰 费用预估
───────────────────────────────
成人 2人 × ¥298 = ¥596
儿童 0人 × ¥238 = ¥0
───────────────────────────────
合计：¥596

📍 接送安排
───────────────────────────────
上午9:00 喆啡酒店大堂集合
下午16:00 返回酒店

⚠️ 温馨提示
───────────────────────────────
• 请提前一天联系我们确认行程
• 需支付100元/人定金确认预约
• 活动当天请穿着保暖衣物

📞 联系方式：138-xxxx-xxxx（郑长岭）

[复制预约信息] [返回首页]
```

**可复制的确认文本（方便客户转发）：**
```
预定双溪森林营地活动
日期：2026-01-29
姓名：徐迅，人数：2人，手机：13821213861
酒店：喆啡
单价：298/人，总金额596元
已收定金：0元，已收尾款0元，待收尾款596元
收款人：，收款时间：

备注：二道白河镇去森林营地免费接送，9点去，16点回。

请提前一天联系我，确认日期和人数
```

#### 13.2.4 后台预约管理

**预约列表页面（运营人员）：**

| 功能 | 说明 |
|------|------|
| 列表展示 | 显示所有预约记录，支持分页 |
| 状态筛选 | 待确认/已确认/已完成/已取消 |
| 日期筛选 | 按预约日期范围筛选 |
| 搜索 | 按姓名、电话、确认码搜索 |
| 快速操作 | 确认预约、转为订单、取消预约 |
| 批量操作 | 批量确认、批量导出 |

**预约状态流转：**
```
pending(待确认) → confirmed(已确认) → converted(已转订单) → completed(已完成)
                       ↓
                  cancelled(已取消)
```

**预约详情页面：**
- 查看完整预约信息
- 编辑预约内容
- 记录定金收款
- 一键转为正式订单
- 添加运营备注

#### 13.2.5 预约转订单

**转换逻辑：**
```javascript
// 预约(Booking) → 订单(Order) 转换
{
  // 自动映射
  customerId: booking.customerId,        // 关联客户
  accommodationPlaceId: findOrCreate(booking.hotelName),
  visitDate: booking.visitDate,
  peopleCount: booking.peopleCount,
  packageId: booking.packageId,

  // 自动计算
  totalAmount: calculateAmount(booking),
  orderNumber: generateOrderNumber(),

  // 默认值
  status: 'confirmed',
  paymentStatus: 'unpaid',

  // 保留关联
  bookingId: booking.id                  // 可追溯来源
}
```

### 13.3 数据库设计

#### 新增表：bookings（预约表）

```prisma
model Booking {
  id              Int       @id @default(autoincrement())
  bookingCode     String    @unique @map("booking_code")  // BK20260129001

  // 客户信息（提交时记录，可能尚未创建Customer）
  customerName    String    @map("customer_name")
  customerPhone   String    @map("customer_phone")
  customerWechat  String?   @map("customer_wechat")

  // 关联客户（处理后关联）
  customerId      Int?      @map("customer_id")

  // 预约详情
  visitDate       DateTime  @map("visit_date")
  peopleCount     Int       @map("people_count")
  childCount      Int       @default(0) @map("child_count")

  // 住宿信息
  hotelName       String    @map("hotel_name")
  hotelId         Int?      @map("hotel_id")              // 关联accommodation_places
  roomNumber      String?   @map("room_number")

  // 套餐信息
  packageId       Int?      @map("package_id")
  packageName     String?   @map("package_name")          // 冗余存储，防止套餐变化

  // 价格信息
  unitPrice       Decimal   @map("unit_price") @db.Decimal(10, 2)
  childPrice      Decimal   @default(0) @map("child_price") @db.Decimal(10, 2)
  totalAmount     Decimal   @map("total_amount") @db.Decimal(10, 2)

  // 定金信息
  depositAmount   Decimal   @default(0) @map("deposit_amount") @db.Decimal(10, 2)
  depositPaidAt   DateTime? @map("deposit_paid_at")
  depositCollector String?  @map("deposit_collector")     // 收款人

  // 状态
  status          String    @default("pending")           // pending/confirmed/converted/completed/cancelled

  // 转换关联
  orderId         Int?      @unique @map("order_id")      // 转为订单后关联

  // 备注
  customerNotes   String?   @map("customer_notes")        // 客户填写的备注
  operatorNotes   String?   @map("operator_notes")        // 运营添加的备注

  // 来源追踪
  source          String    @default("wechat_form")       // wechat_form/manual/other

  // 时间戳
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // 关联
  customer        Customer? @relation(fields: [customerId], references: [id])
  package         Package?  @relation(fields: [packageId], references: [id])
  order           Order?    @relation(fields: [orderId], references: [id])

  @@index([bookingCode])
  @@index([customerPhone])
  @@index([visitDate])
  @@index([status])
  @@index([createdAt])
  @@map("bookings")
}
```

#### 修改 Order 表

```prisma
model Order {
  // ... 现有字段 ...

  // 新增：预约来源
  bookingId       Int?      @unique @map("booking_id")
  booking         Booking?
}
```

#### 修改 Package 表

```prisma
model Package {
  // ... 现有字段 ...

  // 新增：是否在预约表单显示
  showInBookingForm  Boolean  @default(true) @map("show_in_booking_form")

  // 新增：儿童价格（4岁以下）
  childPrice         Decimal? @map("child_price") @db.Decimal(10, 2)

  // 新增：特殊日期价格配置（JSON）
  specialPricing     String?  @map("special_pricing")  // {"2026-01-30~2026-02-03": {"price": 358, "childPrice": 298}}

  bookings           Booking[]
}
```

### 13.4 API设计

#### 13.4.1 公开API（无需认证）

**提交预约**
```
POST /api/public/bookings

Request:
{
  "customerName": "徐迅",
  "customerPhone": "13821213861",
  "customerWechat": "xuxun_wx",
  "visitDate": "2026-01-29",
  "peopleCount": 2,
  "childCount": 0,
  "hotelName": "喆啡酒店",
  "roomNumber": "801",
  "packageId": 1,
  "notes": "希望安排靠窗座位"
}

Response:
{
  "success": true,
  "data": {
    "bookingCode": "BK20260129001",
    "visitDate": "2026-01-29",
    "customerName": "徐迅",
    "peopleCount": 2,
    "childCount": 0,
    "hotelName": "喆啡酒店",
    "packageName": "双溪森林营地全天套餐",
    "unitPrice": 298,
    "childPrice": 238,
    "totalAmount": 596,
    "confirmText": "预定双溪森林营地活动\n日期：2026-01-29\n姓名：徐迅，人数：2人..."
  }
}
```

**获取可用套餐列表**
```
GET /api/public/packages

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "双溪森林营地全天套餐",
      "description": "包含接送、午餐、冰钓、徒步等全天活动",
      "price": 298,
      "childPrice": 238,
      "specialPricing": {
        "2026-01-30~2026-02-03": {
          "price": 358,
          "childPrice": 298,
          "label": "春节特别档期"
        }
      }
    }
  ]
}
```

**获取酒店列表**
```
GET /api/public/hotels

Response:
{
  "success": true,
  "data": [
    { "id": 1, "name": "喆啡酒店", "area": "二道白河" },
    { "id": 2, "name": "长白山国际度假村", "area": "长白山景区" },
    { "id": null, "name": "其他", "area": null }
  ]
}
```

#### 13.4.2 管理API（需认证）

**获取预约列表**
```
GET /api/bookings?status=pending&date=2026-01-29&page=1&pageSize=20

Response:
{
  "success": true,
  "data": {
    "items": [...],
    "total": 50,
    "page": 1,
    "pageSize": 20
  }
}
```

**获取预约详情**
```
GET /api/bookings/:id
```

**更新预约状态**
```
PATCH /api/bookings/:id/status

Request:
{
  "status": "confirmed",
  "operatorNotes": "已电话确认"
}
```

**记录定金**
```
PATCH /api/bookings/:id/deposit

Request:
{
  "depositAmount": 200,
  "depositCollector": "郑长岭"
}
```

**转为订单**
```
POST /api/bookings/:id/convert

Response:
{
  "success": true,
  "data": {
    "orderId": 123,
    "orderNumber": "ORD20260129001"
  }
}
```

**删除预约**
```
DELETE /api/bookings/:id
```

### 13.5 前端页面

#### 13.5.1 公开预约表单页面

**路由**: `/book` 或 `/booking`（公开访问）

**页面结构**:
```
┌─────────────────────────────────────┐
│  🏔️ 长白山双溪森林营地              │
│     冬季活动预约                     │
├─────────────────────────────────────┤
│                                     │
│  📅 选择日期                        │
│  ┌─────────────────────────────┐   │
│  │  2026年1月29日 (周四)    ▼  │   │
│  └─────────────────────────────┘   │
│  ⚠️ 春节期间价格有调整              │
│                                     │
│  👤 您的信息                        │
│  ┌─────────────────────────────┐   │
│  │ 姓名 *                       │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 手机号 *                     │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 微信号（选填）               │   │
│  └─────────────────────────────┘   │
│                                     │
│  👥 参与人数                        │
│  成人  [ - ]  2  [ + ]              │
│  儿童(4岁以下)  [ - ]  0  [ + ]     │
│                                     │
│  🏨 住宿信息                        │
│  ┌─────────────────────────────┐   │
│  │ 选择酒店 *               ▼  │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 房间号（选填）               │   │
│  └─────────────────────────────┘   │
│                                     │
│  🎁 选择套餐                        │
│  ┌─────────────────────────────┐   │
│  │ ○ 全天套餐 ¥298/人          │   │
│  │   含接送、午餐、全部活动      │   │
│  ├─────────────────────────────┤   │
│  │ ○ 半日套餐 ¥198/人          │   │
│  │   含接送、部分活动            │   │
│  └─────────────────────────────┘   │
│                                     │
│  📝 备注（选填）                    │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  💰 费用预估                        │
│  成人 2人 × ¥298 = ¥596            │
│  儿童 0人 × ¥238 = ¥0              │
│  ───────────────────────────────   │
│  合计：¥596                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │       ✓ 提交预约             │   │
│  └─────────────────────────────┘   │
│                                     │
│  提交即表示同意《预约须知》         │
│                                     │
└─────────────────────────────────────┘
```

#### 13.5.2 后台预约管理页面

**路由**: `/bookings`（需登录）

**列表页面**:
```
┌──────────────────────────────────────────────────────────────────┐
│  预约管理                                        [+ 手动添加预约] │
├──────────────────────────────────────────────────────────────────┤
│  筛选: [全部状态 ▼] [选择日期范围] [搜索姓名/电话/确认码]  [搜索] │
├──────────────────────────────────────────────────────────────────┤
│  □ 确认码      日期        姓名    电话         人数  套餐   状态    操作 │
├──────────────────────────────────────────────────────────────────┤
│  □ BK...001   01-29      徐迅    138****3861   2人   全天   🟡待确认  [确认][转订单] │
│  □ BK...002   01-29      李明    139****5678   4人   半日   🟢已确认  [转订单][详情] │
│  □ BK...003   01-30      王芳    137****9012   3人   全天   🔵已转换  [查看订单] │
├──────────────────────────────────────────────────────────────────┤
│  [批量确认] [批量导出]                          共 50 条 < 1/3 > │
└──────────────────────────────────────────────────────────────────┘
```

### 13.6 技术实现要点

#### 13.6.1 公开页面路由配置

```javascript
// App.js 路由配置
<Routes>
  {/* 公开路由 - 无需登录 */}
  <Route path="/book" element={<PublicBookingForm />} />
  <Route path="/booking/success/:code" element={<BookingSuccess />} />

  {/* 登录路由 */}
  <Route path="/login" element={<Login />} />

  {/* 受保护路由 - 需要登录 */}
  <Route path="/bookings" element={<PrivateRoute><BookingList /></PrivateRoute>} />
  {/* ... 其他路由 */}
</Routes>
```

#### 13.6.2 价格计算逻辑

```javascript
// 计算预约总价
function calculateBookingAmount(booking, packageInfo) {
  const { visitDate, peopleCount, childCount } = booking;

  // 检查是否为特殊日期
  let price = packageInfo.price;
  let childPrice = packageInfo.childPrice || price * 0.8;

  if (packageInfo.specialPricing) {
    const special = packageInfo.specialPricing;
    for (const [dateRange, pricing] of Object.entries(special)) {
      const [start, end] = dateRange.split('~');
      if (visitDate >= start && visitDate <= end) {
        price = pricing.price;
        childPrice = pricing.childPrice;
        break;
      }
    }
  }

  const adultCount = peopleCount - childCount;
  const total = adultCount * price + childCount * childPrice;

  return {
    unitPrice: price,
    childPrice,
    adultCount,
    childCount,
    totalAmount: total
  };
}
```

#### 13.6.3 预约确认码生成

```javascript
// 生成预约确认码
async function generateBookingCode(visitDate) {
  const dateStr = format(new Date(visitDate), 'yyyyMMdd');

  // 查询当天已有预约数量
  const count = await prisma.booking.count({
    where: {
      bookingCode: {
        startsWith: `BK${dateStr}`
      }
    }
  });

  const sequence = String(count + 1).padStart(3, '0');
  return `BK${dateStr}${sequence}`;
}
```

#### 13.6.4 微信分享优化

```html
<!-- 微信分享元数据 -->
<head>
  <title>长白山森林营地预约</title>
  <meta name="description" content="冬季冰雪活动预约，包含接送、午餐、冰钓等项目" />

  <!-- 微信分享图片 -->
  <meta property="og:image" content="/images/share-cover.jpg" />
  <meta property="og:title" content="长白山双溪森林营地 - 冬季活动预约" />
  <meta property="og:description" content="石板烧烤、冰钓、雪上滑梯...开心玩一天！" />
</head>
```

### 13.7 安全考虑

| 风险 | 措施 |
|------|------|
| 恶意批量提交 | 添加频率限制（同一手机号5分钟内只能提交1次） |
| 虚假信息 | 手机号格式验证 + 后续人工确认 |
| SQL注入 | 使用Prisma ORM参数化查询 |
| XSS攻击 | React默认转义 + 输入内容过滤 |
| 敏感信息泄露 | 手机号部分脱敏显示 |

### 13.8 后续扩展

**Phase 2 可选功能：**
- 📧 预约成功后发送短信通知
- 💳 在线支付定金
- 📅 日历视图查看预约分布
- 📊 预约转化率统计
- 🔗 生成专属预约链接（追踪推广效果）

### 13.9 验收标准

| 验收项 | 标准 |
|--------|------|
| 表单提交 | 客户可在微信中打开链接并成功提交预约 |
| 数据录入 | 预约信息正确存储到数据库 |
| 客户创建 | 新手机号自动创建客户档案 |
| 价格计算 | 根据人数和日期正确计算金额 |
| 确认页面 | 显示完整预约信息和可复制文本 |
| 后台管理 | 运营可查看、确认、转换预约 |
| 转订单 | 一键转换功能正常工作 |
| 移动适配 | 在微信内置浏览器中显示正常 |

---

## 14. 技术架构

### 14.1 技术栈

**前端**
```
React 18.x + Tailwind CSS + React Router v6
Zustand(状态) + Axios(HTTP) + Recharts(图表)
date-fns + React Hook Form + Zod
```

**后端**
```
Node.js 18.x + Express.js
Prisma(ORM) + SQLite(开发)/PostgreSQL(生产)
JWT + bcrypt
```

### 14.2 目录结构

```
camp-management-system/
├── frontend/
│   ├── src/
│   │   ├── components/    # 组件
│   │   ├── pages/         # 页面
│   │   ├── api/           # API调用
│   │   └── App.jsx
│   └── package.json
│
├── backend/
│   ├── prisma/
│   │   └── schema.prisma  # 数据库Schema
│   ├── src/
│   │   ├── routes/        # 路由
│   │   ├── controllers/   # 控制器
│   │   └── server.js
│   └── package.json
│
├── PRODUCT_REQUIREMENTS.md  # 本文档
├── PRD_PART2.md             # 完整数据库Schema和附录
├── PROJECT_PLAN.md          # 项目计划
├── TODO.md                  # 开发清单
└── DATABASE_DESIGN.md       # 数据库设计
```

### 14.3 API设计示例

```javascript
// GET /api/customers - 获取客户列表
{
  "success": true,
  "data": {
    "customers": [...],
    "total": 100,
    "page": 1,
    "pageSize": 20
  }
}

// POST /api/orders - 创建订单
Request: {
  "customerId": 1,
  "accommodationPlaceId": 2,
  "visitDate": "2026-01-15",
  "peopleCount": 4,
  "projectIds": [1, 3],
  "packageId": null
}

Response: {
  "success": true,
  "data": {
    "orderNumber": "ORD202601090001",
    "totalAmount": 480
  }
}
```

---

## 15. 开发计划

### 15.1 时间线

```
Week 1-2  │ ████████████░░░░░░░░ │ MVP (40%)
          │ - 认证 + 客户 + 订单
          
Week 3-4  │ ████████████████░░░░ │ 核心功能 (80%)
          │ - 住宿 + 接送 + 套餐 + 基础排期
          
Week 5-6  │ ████████████████████ │ 完整版 (100%)
          │ - 完整排期 + 统计 + 内容
          
Week 7-9  │ ░░░░░░░░░░░░░░░░░░░░ │ 移动端 (可选)
          │ - 司机端 + 教练端 App
```

### 15.2 里程碑

| 里程碑 | 日期 | 交付内容 |
|-------|------|---------|
| 🎯 M1: MVP | Week 2 | 基础管理功能可用 |
| 🎯 M2: 核心功能 | Week 4 | 接送调度完整 |
| 🎯 M3: 生产就绪 | Week 6 | 可上线使用 |
| 🎯 M4: 移动端 | Week 9 | 移动App完成 |

### 15.3 今日任务 (Day 1)

- [ ] 安装 Node.js 18.x
- [ ] 安装 Git 和 VS Code
- [ ] 创建项目目录
- [ ] 初始化前后端项目
- [ ] 安装依赖包
- [ ] 设计数据库Schema
- [ ] 配置Prisma

**预计耗时**: 2-3小时

---

## 📊 开发进度追踪

### 当前进度

| 模块 | 状态 | 完成度 | 备注 |
|------|------|--------|------|
| 环境搭建 | ✅ | 100% | 已完成PRD |
| 用户认证 | ⏳ | 0% | - |
| 客户管理 | ⏳ | 0% | - |
| 订单管理 | ⏳ | 0% | - |
| 住宿管理 | ⏳ | 0% | - |
| 接送调度 | ⏳ | 0% | - |
| 套餐管理 | ⏳ | 0% | - |
| 行程排期 | ⏳ | 0% | - |
| 内容管理 | ⏳ | 0% | - |
| 统计分析 | ⏳ | 0% | - |
| **客户自助预约** | ⏳ | 0% | V2.1新增 |

**图例**: ⏳待开发 | 🚧开发中 | ✅已完成 | ⚠️需优化

---

## 🚀 快速开始

### 1. 环境准备

```bash
# 1. 安装Node.js (https://nodejs.org)
node -v  # 验证: v18.x+

# 2. 安装Git
git --version

# 3. 克隆项目
git clone <your-repo>
cd camp-management-system
```

### 2. 后端启动

```bash
cd backend
npm install
cp .env.example .env  # 配置环境变量
npx prisma migrate dev --name init
npx prisma generate
npm run dev  # 启动: http://localhost:3000
```

### 3. 前端启动

```bash
cd frontend
npm install
npm run dev  # 启动: http://localhost:5173
```

### 4. 数据库管理

```bash
npx prisma studio  # 打开: http://localhost:5555
```

---

## 📝 更新日志

**2026-01-09 - V2.0**
- ✅ 完成产品需求文档
- ✅ 新增4大核心模块(住宿/接送/套餐/排期)
- ✅ 完成数据库设计
- ✅ 制定开发计划

---

## 📞 联系方式

- **产品负责人**: [待填写]
- **技术负责人**: [待填写]
- **营地负责人**: [待填写]

---

**继续阅读**: 
- 📄 [Part 2: 完整数据库Schema和附录](./PRD_PART2.md)
- 📋 [开发任务清单](./TODO.md)
- 🗂️ [数据库设计详细文档](./DATABASE_DESIGN.md)
- 📅 [项目计划](./PROJECT_PLAN.md)

**文档状态**: ✅ 已完成 | 📅 最后更新: 2026-01-09
