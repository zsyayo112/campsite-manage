# 长白山营地旅游管理系统 - 产品需求文档 (Part 1)

**版本**: V2.0 (增强版)  
**日期**: 2026年1月9日  
**状态**: 待开发

> 💡 **提示**: 本文档较长，已分为两部分。Part 2包含完整的数据库Schema、附录和参考资料。

---

## 📑 快速导航

- **核心模块**: [用户认证](#4-用户认证模块) | [客户管理](#5-客户管理模块) | [订单管理](#6-订单管理模块)
- **新增模块**: [住宿管理](#7-住宿管理模块) | [接送调度](#8-接送调度模块) | [套餐管理](#9-套餐管理模块) | [行程排期](#10-行程排期模块)
- **⭐ 客户自助预约**: [客户预约表单](#13-客户自助预约模块)
- **⭐ 活动展示自定义**: [套餐管理](#15-活动展示自定义与套餐管理模块-v23新增) | [多媒体内容](#153-活动项目多媒体管理) | [公开展示](#154-公开展示页面优化)
- **辅助模块**: [内容管理](#11-内容管理模块) | [统计分析](#12-统计分析模块)
- **开发指南**: [技术架构](#14-技术架构) | [开发计划](#15-开发计划)

---

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 长白山营地旅游管理系统产品需求文档 |
| 文档版本 | V2.0（增强版） |
| 更新日期 | 2026年1月9日 |
| 项目名称 | 长白山营地旅游管理系统 |
| 项目特色 | ⭐ 住宿管理 ⭐ 接送调度 ⭐ 套餐组合 ⭐ 行程排期 |
| 目标用户 | 营地运营管理人员、司机、活动教练 |

### 1.1 版本更新说明

**V2.0 新增功能：**
- ✅ **住宿类型管理**：区分自营宾馆和外部住宿
- ✅ **接送调度系统**：每日人数统计、车辆安排、线路规划
- ✅ **套餐管理系统**：灵活组合项目、多种套餐方案
- ✅ **行程排期系统**：每日时间表、项目时段安排、团队协调
- ✅ **长白山营销素材**：景区特色、季节推广、游记模板

**V2.1 新增功能：**
- ⭐ **客户自助预约系统**：微信分享表单、客户自助填写、自动录入订单

**V2.2 新增功能：**
- 🔧 **预约表单优化**：调整表单布局顺序、修复人数选择Bug、取消酒店选择改为备注
- 📋 **订单自助查询**：客户可通过手机号查看自己的订单确认状态
- 🏕️ **营地活动介绍页面**：公开展示营地活动内容，支持微信小程序对接

**V2.3 新增功能：**
- 🎁 **套餐自定义管理**：后台完整管理套餐内容、价格、展示配置
- 📷 **多媒体内容支持**：套餐和活动支持上传图片、视频介绍
- 📊 **套餐对比功能**：提供套餐对比表格帮助客户选择
- 🎬 **视频介绍功能**：支持本地上传或嵌入第三方视频（腾讯、B站）
- ↕️ **拖拽排序**：支持拖拽调整套餐和活动展示顺序

---

## 2. 产品概述

### 2.1 产品背景

本营地位于**长白山旅游区**，提供独特的冬季户外体验项目。

#### 业务特点

- **客源多样**：既有住在自营宾馆的客人，也有住在小镇其他酒店的游客
- **需要接送**：每日需统计参与人数，安排大巴车往返接送
- **套餐灵活**：客人可单选项目，也可选择多项目组合
- **时间协调**：需合理安排各项目时间段，支持游学团队等大型活动
- **季节特色**：冬季主推冰雪项目，结合长白山景区特色

#### 现有痛点

- ❌ 无法准确统计每日出发人数和住宿分布
- ❌ 套餐组合依靠手工记录，容易出错
- ❌ 项目时间安排凭经验，无系统化排期
- ❌ 营销内容散乱，未充分利用长白山品牌
- ❌ **微信沟通下单效率低**，需要人工整理客户信息录入系统

### 2.2 核心业务场景

#### 场景1：散客预订 👤

```
客人小红书看到推广 → 选择"石板烧烤+冰钓" → 住"长白山大酒店"
  ↓
系统记录信息 → 活动当天统计接送人数 → 安排车辆 → 司机接客
```

#### 场景2：游学团队 👥

```
学校预订50人 → 选择全套项目 → 住自营宾馆
  ↓
系统生成行程表:
  9:00  出发
  10:00-12:00  冰钓
  12:00-14:00  午餐烧烤
  14:00-16:00  雪上滑梯
  16:00  返回
  ↓
教练根据行程准备，避免冲突
```

#### 场景3：多批次接送 🚌

```
当天3批客人:
  A酒店 10人(9:00)
  B宾馆 8人(9:30)
  自营宾馆 15人(10:00)
  ↓
系统生成方案:
  车辆1 → A酒店
  车辆2 → B宾馆 → 自营宾馆
```

#### 场景4：微信客户自助预约 📱 ⭐新增

```
典型微信对话:
  营地: 发送活动介绍和价格
  客人: "1月29日，二道白河喆啡酒店，徐迅，13821213861，两个人"
  ↓
传统流程(低效):
  运营手动整理 → 复制到Excel → 再录入系统
  ↓
新流程(自动化):
  营地: 发送预约链接
  客人: 打开表单 → 填写信息 → 提交
  系统: 自动创建客户 → 自动创建订单 → 通知运营
```

### 2.3 冬季项目清单

| 项目 | 时长 | 人数 | 特色 | 价格 |
|------|------|------|------|------|
| 🔥 石板烧烤 | 2h | 10-50人 | 长白山特色石板烤肉 | ¥98/人 |
| ⛷️ 雪上滑梯乐园 | 1.5h | 不限 | 多条滑道，全家欢 | ¥68/人 |
| 🎣 冰钓体验 | 2h | 5-30人 | 专业教练指导 | ¥128/人 |
| 🌲 冬日丛林穿越 | 1h | 10-30人 | 探索雪森林、赏雾凇 | ¥88/人 |
| 🍬 烤棉花糖 | 30min | 不限 | 篝火旁互动 | ¥20/人 |
| 🍠 烤地瓜 | 30min | 不限 | 传统美食 | ¥15/人 |

---

## 3. 功能架构

### 3.1 系统架构图

```
长白山营地管理系统
│
├── 🔐 用户认证
│   ├── 登录/登出
│   ├── 多角色(管理员/司机/教练)
│   └── 权限控制
│
├── 👥 客户管理 (CRM)
│   ├── 客户档案
│   ├── 标签分类
│   └── 消费统计
│
├── 📋 订单管理
│   ├── 订单CRUD
│   ├── 状态流转
│   └── 项目配置
│
├── 🏨 住宿管理 ⭐新增
│   ├── 地点配置
│   ├── 类型区分(自营/外部)
│   └── 分布统计
│
├── 🚌 接送调度 ⭐新增
│   ├── 人数统计
│   ├── 车辆管理
│   ├── 路线规划
│   └── 接送单生成
│
├── 🎁 套餐管理 ⭐新增
│   ├── 套餐配置
│   ├── 价格策略
│   └── 灵活组合
│
├── 📅 行程排期 ⭐新增
│   ├── 时间表
│   ├── 冲突检测
│   ├── 教练安排
│   └── 容量控制
│
├── 📱 客户自助预约 ⭐V2.1新增
│   ├── 公开预约表单
│   ├── 套餐选择
│   ├── 自动创建客户/订单
│   ├── 预约记录管理
│   └── 微信分享支持
│
├── 📝 内容管理
│   ├── 小红书笔记
│   ├── 数据统计
│   └── 发布计划
│
└── 📊 统计分析
    ├── 仪表盘
    ├── 详细报表
    └── 数据导出
```

### 3.2 功能优先级

| 优先级 | 功能 | 预计时间 | 状态 |
|-------|------|---------|------|
| **P0** | 用户认证 + 客户管理 + 订单管理 | Week 1-2 | ⏳ |
| **P0** | 住宿管理 + 基础套餐 | Week 2 | ⏳ |
| **P1** | 接送调度 + 车辆管理 | Week 3 | ⏳ |
| **P1** | 套餐管理完整 + 基础排期 | Week 4 | ⏳ |
| **P2** | 行程排期完整 + 统计分析 | Week 5-6 | ⏳ |
| **P1** | 客户自助预约系统 | Week 4-5 | ⏳ |
| **P3** | 司机端/教练端 App | Week 7-9 | ⏳ |

---

## 4-13. 详细功能需求

> 📌 **说明**: 以下各模块的详细需求包含：
> - 功能描述
> - 详细需求列表
> - 界面设计
> - 交互流程
> - 数据字典
> - 开发状态追踪

由于篇幅原因，各模块详细内容请参考原完整PRD文档（Word版）或查看代码库中的模块开发文档。

### 核心要点速查

**4. 用户认证**
- JWT Token认证
- 5种角色权限
- 状态: ⏳ 待开发

**5. 客户管理**  
- 客户列表/详情/编辑
- 标签系统(VIP/复购/意向等)
- 自动统计消费和访问
- 状态: ⏳ 待开发

**6. 订单管理**
- 订单号规则: ORD{YYYYMMDD}{序号}
- 4种状态: pending → confirmed → completed
- 关联客户、住宿、套餐
- 状态: ⏳ 待开发

**7. 住宿管理** ⭐
- 预设: 自营宾馆、长白山度假村、万达、二道白河
- 记录距离和车程
- 状态: ⏳ 待开发

**8. 接送调度** ⭐
- 按日期+住宿地点统计人数
- 车辆/司机管理
- 生成接送单(路线+客人名单)
- 状态追踪: 待出发→接送中→已完成
- 状态: ⏳ 待开发

**9. 套餐管理** ⭐
- 预设6种套餐(单项/双项/冰雪/美食/全景/团队)
- 支持自由组合
- 智能价格计算
- 状态: ⏳ 待开发

**10. 行程排期** ⭐
- 时间轴视图(8:00-18:00)
- 项目时段分配
- 4类冲突检测(场地/教练/时间/车辆)
- 教练管理
- 状态: ⏳ 待开发

**11. 内容管理**
- 小红书笔记CRUD
- 数据统计(浏览/点赞/评论/收藏)
- 发布计划日历
- 状态: ⏳ 待开发

**12. 统计分析**
- 4个核心指标卡片
- 4类可视化图表
- 多维度报表
- Excel/CSV导出
- 状态: ⏳ 待开发

**13. 长白山营销**
- 景区特色标签
- 季节营销策略
- 营销模板库
- 状态: ⏳ 待开发

---

## 13. 客户自助预约模块 ⭐V2.1新增

### 13.1 模块概述

#### 业务背景

目前营地通过微信与客户沟通预订，典型对话流程：

```
营地发送活动介绍：
"包括二道白河镇接送，包括午餐石板烧烤，包括原始凿冰钓鱼、森林轻徒步、
松针熏鱼、小鹿陪同等很多活动，开心玩一天...
姓名、电话，人数、酒店位置发我，费用298/人，四岁以下238/人..."

客户回复：
"1月29日，二道白河喆啡酒店，徐迅，13821213861，两个人"

运营人员需要：
1. 从微信聊天中提取信息
2. 手动录入客户资料
3. 手动创建订单
4. 计算金额并回复确认信息
```

**痛点分析：**
- ❌ 人工提取信息容易出错（姓名、电话、日期等）
- ❌ 高峰期消息多，处理不及时
- ❌ 信息格式不统一，增加整理难度
- ❌ 无法追踪预约状态
- ❌ 重复劳动，效率低下

#### 解决方案

提供**客户自助预约表单**，客户通过微信分享的链接填写预约信息，系统自动：
1. 创建/更新客户档案
2. 创建预约订单
3. 计算费用
4. 生成确认信息

### 13.2 功能需求

#### 13.2.1 公开预约表单页面

**页面特点：**
- 🔓 **无需登录**：客户可直接访问填写
- 📱 **移动端优先**：适配微信内置浏览器
- 🎨 **简洁美观**：突出长白山营地品牌
- ⚡ **快速加载**：优化首屏加载速度

**表单字段：**

| 字段 | 类型 | 必填 | 说明 | 验证规则 |
|------|------|------|------|---------|
| 姓名 | 文本 | ✅ | 预约人姓名 | 2-20字符 |
| 手机号 | 文本 | ✅ | 联系电话 | 11位手机号格式 |
| 微信号 | 文本 | ❌ | 微信联系方式 | - |
| 预约日期 | 日期 | ✅ | 活动日期 | 不早于明天 |
| 人数 | 数字 | ✅ | 参与人数 | 1-50人 |
| 儿童人数 | 数字 | ❌ | 4岁以下儿童 | 0-人数 |
| 酒店名称 | 下拉/文本 | ✅ | 住宿地点 | 支持自定义输入 |
| 房间号 | 文本 | ❌ | 方便接送联系 | - |
| 套餐选择 | 单选 | ✅ | 选择活动套餐 | 从可用套餐中选择 |
| 备注 | 文本域 | ❌ | 特殊需求说明 | 最多500字 |

**酒店选项预设：**
```
- 喆啡酒店（二道白河）
- 长白山国际度假村
- 万达度假区酒店
- 营地自营宾馆
- 其他（请填写）
```

**套餐选项（从系统读取）：**
```
- 双溪森林营地全天套餐 - ¥298/人（儿童¥238）
- 冰雪乐园半日套餐 - ¥198/人
- 石板烧烤单项体验 - ¥98/人
- 其他（联系客服定制）
```

**特殊日期价格提示：**
```
⚠️ 初二到初六(2026-01-30至2026-02-03)为春节特别档期
价格调整为：成人358元/人，儿童298元/人
```

#### 13.2.2 预约提交流程

```
┌─────────────────────────────────────────────────────────┐
│                    客户填写表单                          │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    前端表单验证                          │
│  - 必填字段检查                                          │
│  - 手机号格式验证                                        │
│  - 日期合理性验证                                        │
│  - 人数范围验证                                          │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    提交到后端API                         │
│  POST /api/public/bookings                              │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    后端处理逻辑                          │
│  1. 验证数据完整性                                       │
│  2. 检查手机号是否已存在客户                             │
│     - 存在: 更新客户信息                                 │
│     - 不存在: 创建新客户                                 │
│  3. 创建预约记录(Booking)                               │
│  4. 计算预估金额                                         │
│  5. 生成预约确认码                                       │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    返回确认页面                          │
│  - 预约确认码                                            │
│  - 预约详情摘要                                          │
│  - 预估费用明细                                          │
│  - 联系方式和注意事项                                    │
│  - 可复制的确认信息文本                                  │
└─────────────────────────────────────────────────────────┘
```

#### 13.2.3 预约确认页面

**显示内容：**

```
✅ 预约提交成功！

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
预约确认码: BK20260129001
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 预约信息
───────────────────────────────
日期：2026-01-29（周四）
姓名：徐迅
电话：138****3861
人数：2人（成人2人）
酒店：喆啡酒店
套餐：双溪森林营地全天套餐

💰 费用预估
───────────────────────────────
成人 2人 × ¥298 = ¥596
儿童 0人 × ¥238 = ¥0
───────────────────────────────
合计：¥596

📍 接送安排
───────────────────────────────
上午9:00 喆啡酒店大堂集合
下午16:00 返回酒店

⚠️ 温馨提示
───────────────────────────────
• 请提前一天联系我们确认行程
• 需支付100元/人定金确认预约
• 活动当天请穿着保暖衣物

📞 联系方式：138-xxxx-xxxx（郑长岭）

[复制预约信息] [返回首页]
```

**可复制的确认文本（方便客户转发）：**
```
预定双溪森林营地活动
日期：2026-01-29
姓名：徐迅，人数：2人，手机：13821213861
酒店：喆啡
单价：298/人，总金额596元
已收定金：0元，已收尾款0元，待收尾款596元
收款人：，收款时间：

备注：二道白河镇去森林营地免费接送，9点去，16点回。

请提前一天联系我，确认日期和人数
```

#### 13.2.4 后台预约管理

**预约列表页面（运营人员）：**

| 功能 | 说明 |
|------|------|
| 列表展示 | 显示所有预约记录，支持分页 |
| 状态筛选 | 待确认/已确认/已完成/已取消 |
| 日期筛选 | 按预约日期范围筛选 |
| 搜索 | 按姓名、电话、确认码搜索 |
| 快速操作 | 确认预约、转为订单、取消预约 |
| 批量操作 | 批量确认、批量导出 |

**预约状态流转：**
```
pending(待确认) → confirmed(已确认) → converted(已转订单) → completed(已完成)
                       ↓
                  cancelled(已取消)
```

**预约详情页面：**
- 查看完整预约信息
- 编辑预约内容
- 记录定金收款
- 一键转为正式订单
- 添加运营备注

#### 13.2.5 预约转订单

**转换逻辑：**
```javascript
// 预约(Booking) → 订单(Order) 转换
{
  // 自动映射
  customerId: booking.customerId,        // 关联客户
  accommodationPlaceId: findOrCreate(booking.hotelName),
  visitDate: booking.visitDate,
  peopleCount: booking.peopleCount,
  packageId: booking.packageId,

  // 自动计算
  totalAmount: calculateAmount(booking),
  orderNumber: generateOrderNumber(),

  // 默认值
  status: 'confirmed',
  paymentStatus: 'unpaid',

  // 保留关联
  bookingId: booking.id                  // 可追溯来源
}
```

### 13.3 数据库设计

#### 新增表：bookings（预约表）

```prisma
model Booking {
  id              Int       @id @default(autoincrement())
  bookingCode     String    @unique @map("booking_code")  // BK20260129001

  // 客户信息（提交时记录，可能尚未创建Customer）
  customerName    String    @map("customer_name")
  customerPhone   String    @map("customer_phone")
  customerWechat  String?   @map("customer_wechat")

  // 关联客户（处理后关联）
  customerId      Int?      @map("customer_id")

  // 预约详情
  visitDate       DateTime  @map("visit_date")
  peopleCount     Int       @map("people_count")
  childCount      Int       @default(0) @map("child_count")

  // 住宿信息
  hotelName       String    @map("hotel_name")
  hotelId         Int?      @map("hotel_id")              // 关联accommodation_places
  roomNumber      String?   @map("room_number")

  // 套餐信息
  packageId       Int?      @map("package_id")
  packageName     String?   @map("package_name")          // 冗余存储，防止套餐变化

  // 价格信息
  unitPrice       Decimal   @map("unit_price") @db.Decimal(10, 2)
  childPrice      Decimal   @default(0) @map("child_price") @db.Decimal(10, 2)
  totalAmount     Decimal   @map("total_amount") @db.Decimal(10, 2)

  // 定金信息
  depositAmount   Decimal   @default(0) @map("deposit_amount") @db.Decimal(10, 2)
  depositPaidAt   DateTime? @map("deposit_paid_at")
  depositCollector String?  @map("deposit_collector")     // 收款人

  // 状态
  status          String    @default("pending")           // pending/confirmed/converted/completed/cancelled

  // 转换关联
  orderId         Int?      @unique @map("order_id")      // 转为订单后关联

  // 备注
  customerNotes   String?   @map("customer_notes")        // 客户填写的备注
  operatorNotes   String?   @map("operator_notes")        // 运营添加的备注

  // 来源追踪
  source          String    @default("wechat_form")       // wechat_form/manual/other

  // 时间戳
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // 关联
  customer        Customer? @relation(fields: [customerId], references: [id])
  package         Package?  @relation(fields: [packageId], references: [id])
  order           Order?    @relation(fields: [orderId], references: [id])

  @@index([bookingCode])
  @@index([customerPhone])
  @@index([visitDate])
  @@index([status])
  @@index([createdAt])
  @@map("bookings")
}
```

#### 修改 Order 表

```prisma
model Order {
  // ... 现有字段 ...

  // 新增：预约来源
  bookingId       Int?      @unique @map("booking_id")
  booking         Booking?
}
```

#### 修改 Package 表

```prisma
model Package {
  // ... 现有字段 ...

  // 新增：是否在预约表单显示
  showInBookingForm  Boolean  @default(true) @map("show_in_booking_form")

  // 新增：儿童价格（4岁以下）
  childPrice         Decimal? @map("child_price") @db.Decimal(10, 2)

  // 新增：特殊日期价格配置（JSON）
  specialPricing     String?  @map("special_pricing")  // {"2026-01-30~2026-02-03": {"price": 358, "childPrice": 298}}

  bookings           Booking[]
}
```

### 13.4 API设计

#### 13.4.1 公开API（无需认证）

**提交预约**
```
POST /api/public/bookings

Request:
{
  "customerName": "徐迅",
  "customerPhone": "13821213861",
  "customerWechat": "xuxun_wx",
  "visitDate": "2026-01-29",
  "peopleCount": 2,
  "childCount": 0,
  "hotelName": "喆啡酒店",
  "roomNumber": "801",
  "packageId": 1,
  "notes": "希望安排靠窗座位"
}

Response:
{
  "success": true,
  "data": {
    "bookingCode": "BK20260129001",
    "visitDate": "2026-01-29",
    "customerName": "徐迅",
    "peopleCount": 2,
    "childCount": 0,
    "hotelName": "喆啡酒店",
    "packageName": "双溪森林营地全天套餐",
    "unitPrice": 298,
    "childPrice": 238,
    "totalAmount": 596,
    "confirmText": "预定双溪森林营地活动\n日期：2026-01-29\n姓名：徐迅，人数：2人..."
  }
}
```

**获取可用套餐列表**
```
GET /api/public/packages

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "双溪森林营地全天套餐",
      "description": "包含接送、午餐、冰钓、徒步等全天活动",
      "price": 298,
      "childPrice": 238,
      "specialPricing": {
        "2026-01-30~2026-02-03": {
          "price": 358,
          "childPrice": 298,
          "label": "春节特别档期"
        }
      }
    }
  ]
}
```

**获取酒店列表**
```
GET /api/public/hotels

Response:
{
  "success": true,
  "data": [
    { "id": 1, "name": "喆啡酒店", "area": "二道白河" },
    { "id": 2, "name": "长白山国际度假村", "area": "长白山景区" },
    { "id": null, "name": "其他", "area": null }
  ]
}
```

#### 13.4.2 管理API（需认证）

**获取预约列表**
```
GET /api/bookings?status=pending&date=2026-01-29&page=1&pageSize=20

Response:
{
  "success": true,
  "data": {
    "items": [...],
    "total": 50,
    "page": 1,
    "pageSize": 20
  }
}
```

**获取预约详情**
```
GET /api/bookings/:id
```

**更新预约状态**
```
PATCH /api/bookings/:id/status

Request:
{
  "status": "confirmed",
  "operatorNotes": "已电话确认"
}
```

**记录定金**
```
PATCH /api/bookings/:id/deposit

Request:
{
  "depositAmount": 200,
  "depositCollector": "郑长岭"
}
```

**转为订单**
```
POST /api/bookings/:id/convert

Response:
{
  "success": true,
  "data": {
    "orderId": 123,
    "orderNumber": "ORD20260129001"
  }
}
```

**删除预约**
```
DELETE /api/bookings/:id
```

### 13.5 前端页面

#### 13.5.1 公开预约表单页面

**路由**: `/book` 或 `/booking`（公开访问）

**页面结构**:
```
┌─────────────────────────────────────┐
│  🏔️ 长白山双溪森林营地              │
│     冬季活动预约                     │
├─────────────────────────────────────┤
│                                     │
│  📅 选择日期                        │
│  ┌─────────────────────────────┐   │
│  │  2026年1月29日 (周四)    ▼  │   │
│  └─────────────────────────────┘   │
│  ⚠️ 春节期间价格有调整              │
│                                     │
│  👤 您的信息                        │
│  ┌─────────────────────────────┐   │
│  │ 姓名 *                       │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 手机号 *                     │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 微信号（选填）               │   │
│  └─────────────────────────────┘   │
│                                     │
│  👥 参与人数                        │
│  成人  [ - ]  2  [ + ]              │
│  儿童(4岁以下)  [ - ]  0  [ + ]     │
│                                     │
│  🏨 住宿信息                        │
│  ┌─────────────────────────────┐   │
│  │ 选择酒店 *               ▼  │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 房间号（选填）               │   │
│  └─────────────────────────────┘   │
│                                     │
│  🎁 选择套餐                        │
│  ┌─────────────────────────────┐   │
│  │ ○ 全天套餐 ¥298/人          │   │
│  │   含接送、午餐、全部活动      │   │
│  ├─────────────────────────────┤   │
│  │ ○ 半日套餐 ¥198/人          │   │
│  │   含接送、部分活动            │   │
│  └─────────────────────────────┘   │
│                                     │
│  📝 备注（选填）                    │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  💰 费用预估                        │
│  成人 2人 × ¥298 = ¥596            │
│  儿童 0人 × ¥238 = ¥0              │
│  ───────────────────────────────   │
│  合计：¥596                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │       ✓ 提交预约             │   │
│  └─────────────────────────────┘   │
│                                     │
│  提交即表示同意《预约须知》         │
│                                     │
└─────────────────────────────────────┘
```

#### 13.5.2 后台预约管理页面

**路由**: `/bookings`（需登录）

**列表页面**:
```
┌──────────────────────────────────────────────────────────────────┐
│  预约管理                                        [+ 手动添加预约] │
├──────────────────────────────────────────────────────────────────┤
│  筛选: [全部状态 ▼] [选择日期范围] [搜索姓名/电话/确认码]  [搜索] │
├──────────────────────────────────────────────────────────────────┤
│  □ 确认码      日期        姓名    电话         人数  套餐   状态    操作 │
├──────────────────────────────────────────────────────────────────┤
│  □ BK...001   01-29      徐迅    138****3861   2人   全天   🟡待确认  [确认][转订单] │
│  □ BK...002   01-29      李明    139****5678   4人   半日   🟢已确认  [转订单][详情] │
│  □ BK...003   01-30      王芳    137****9012   3人   全天   🔵已转换  [查看订单] │
├──────────────────────────────────────────────────────────────────┤
│  [批量确认] [批量导出]                          共 50 条 < 1/3 > │
└──────────────────────────────────────────────────────────────────┘
```

### 13.6 技术实现要点

#### 13.6.1 公开页面路由配置

```javascript
// App.js 路由配置
<Routes>
  {/* 公开路由 - 无需登录 */}
  <Route path="/book" element={<PublicBookingForm />} />
  <Route path="/booking/success/:code" element={<BookingSuccess />} />

  {/* 登录路由 */}
  <Route path="/login" element={<Login />} />

  {/* 受保护路由 - 需要登录 */}
  <Route path="/bookings" element={<PrivateRoute><BookingList /></PrivateRoute>} />
  {/* ... 其他路由 */}
</Routes>
```

#### 13.6.2 价格计算逻辑

```javascript
// 计算预约总价
function calculateBookingAmount(booking, packageInfo) {
  const { visitDate, peopleCount, childCount } = booking;

  // 检查是否为特殊日期
  let price = packageInfo.price;
  let childPrice = packageInfo.childPrice || price * 0.8;

  if (packageInfo.specialPricing) {
    const special = packageInfo.specialPricing;
    for (const [dateRange, pricing] of Object.entries(special)) {
      const [start, end] = dateRange.split('~');
      if (visitDate >= start && visitDate <= end) {
        price = pricing.price;
        childPrice = pricing.childPrice;
        break;
      }
    }
  }

  const adultCount = peopleCount - childCount;
  const total = adultCount * price + childCount * childPrice;

  return {
    unitPrice: price,
    childPrice,
    adultCount,
    childCount,
    totalAmount: total
  };
}
```

#### 13.6.3 预约确认码生成

```javascript
// 生成预约确认码
async function generateBookingCode(visitDate) {
  const dateStr = format(new Date(visitDate), 'yyyyMMdd');

  // 查询当天已有预约数量
  const count = await prisma.booking.count({
    where: {
      bookingCode: {
        startsWith: `BK${dateStr}`
      }
    }
  });

  const sequence = String(count + 1).padStart(3, '0');
  return `BK${dateStr}${sequence}`;
}
```

#### 13.6.4 微信分享优化

```html
<!-- 微信分享元数据 -->
<head>
  <title>长白山森林营地预约</title>
  <meta name="description" content="冬季冰雪活动预约，包含接送、午餐、冰钓等项目" />

  <!-- 微信分享图片 -->
  <meta property="og:image" content="/images/share-cover.jpg" />
  <meta property="og:title" content="长白山双溪森林营地 - 冬季活动预约" />
  <meta property="og:description" content="石板烧烤、冰钓、雪上滑梯...开心玩一天！" />
</head>
```

### 13.7 安全考虑

| 风险 | 措施 |
|------|------|
| 恶意批量提交 | 添加频率限制（同一手机号5分钟内只能提交1次） |
| 虚假信息 | 手机号格式验证 + 后续人工确认 |
| SQL注入 | 使用Prisma ORM参数化查询 |
| XSS攻击 | React默认转义 + 输入内容过滤 |
| 敏感信息泄露 | 手机号部分脱敏显示 |

### 13.8 后续扩展

**Phase 2 可选功能：**
- 📧 预约成功后发送短信通知
- 💳 在线支付定金
- 📅 日历视图查看预约分布
- 📊 预约转化率统计
- 🔗 生成专属预约链接（追踪推广效果）

### 13.9 验收标准

| 验收项 | 标准 |
|--------|------|
| 表单提交 | 客户可在微信中打开链接并成功提交预约 |
| 数据录入 | 预约信息正确存储到数据库 |
| 客户创建 | 新手机号自动创建客户档案 |
| 价格计算 | 根据人数和日期正确计算金额 |
| 确认页面 | 显示完整预约信息和可复制文本 |
| 后台管理 | 运营可查看、确认、转换预约 |
| 转订单 | 一键转换功能正常工作 |
| 移动适配 | 在微信内置浏览器中显示正常 |

---

## 14. 预约表单优化与订单查询模块 ⭐V2.2新增

### 14.1 模块概述

#### 需求背景

V2.1版本上线后，运营反馈以下问题需要优化：

1. **表单布局不合理**：当前字段顺序不符合用户填写习惯
2. **人数选择Bug**：修改儿童人数时，成人数量会意外改变
3. **酒店选择过于复杂**：客户住宿地点多样，下拉选择不够灵活
4. **缺少订单跟踪**：客户提交预约后无法自助查看确认状态
5. **缺少活动介绍**：客户无法提前了解营地活动详情

#### 目标

- ✅ 优化表单用户体验，提高填写效率
- ✅ 修复人数选择器Bug
- ✅ 简化住宿信息录入
- ✅ 让客户可自助查询订单状态
- ✅ 提供营地活动介绍页面，为微信小程序对接做准备

---

### 14.2 预约表单优化

#### 14.2.1 表单字段顺序调整

**调整前顺序（V2.1）：**
```
日期 → 姓名 → 手机号 → 微信号 → 成人人数 → 儿童人数 → 酒店选择 → 房间号 → 套餐选择 → 备注
```

**调整后顺序（V2.2）：**
```
姓名 → 手机号 → 微信号 → 人数（成人+儿童） → 住宿备注 → 日期 → 套餐选择 → 备注
```

**调整理由：**
- 姓名和联系方式放最前面，符合用户心理预期
- 人数信息紧随其后，便于快速填写
- 日期和套餐选择放后面，需要思考的内容延后

#### 14.2.2 表单字段定义

| 字段 | 类型 | 必填 | 说明 | 验证规则 | 变更说明 |
|------|------|------|------|---------|----------|
| 姓名 | 文本 | ✅ | 预约人姓名 | 2-20字符 | 顺序调整为第1位 |
| 手机号 | 文本 | ✅ | 联系电话 | 11位手机号格式 | 顺序调整为第2位 |
| 微信号 | 文本 | ❌ | 微信联系方式 | - | 顺序调整为第3位 |
| 成人人数 | 数字 | ✅ | 4岁以上人数 | 1-50人 | **修复Bug：独立计数** |
| 儿童人数 | 数字 | ❌ | 4岁以下人数 | 0-50人 | **修复Bug：独立计数** |
| 住宿备注 | 文本 | ❌ | 住宿地点说明 | 最多100字 | **新增：替代酒店下拉选择** |
| 预约日期 | 日期 | ✅ | 活动日期 | 不早于明天 | 顺序调整为第6位 |
| 套餐选择 | 单选 | ✅ | 选择活动套餐 | 从可用套餐中选择 | 保持不变 |
| 备注 | 文本域 | ❌ | 其他特殊需求 | 最多500字 | 保持不变 |

#### 14.2.3 人数选择器Bug修复

**问题描述：**
当前人数选择器存在联动Bug，修改儿童数量时会影响成人数量。

**问题原因：**
原设计使用 `peopleCount`（总人数）和 `childCount`（儿童人数）两个字段，成人数通过 `peopleCount - childCount` 计算得出。当修改儿童数量时，如果代码逻辑处理不当，会导致总人数变化。

**修复方案：**
改为使用 `adultCount`（成人人数）和 `childCount`（儿童人数）两个独立字段：

```javascript
// 修复前
const [peopleCount, setPeopleCount] = useState(2);
const [childCount, setChildCount] = useState(0);
const adultCount = peopleCount - childCount; // 可能出问题

// 修复后
const [adultCount, setAdultCount] = useState(2);   // 成人：独立状态
const [childCount, setChildCount] = useState(0);   // 儿童：独立状态
const totalCount = adultCount + childCount;        // 总人数：计算得出
```

**UI设计：**
```
👥 参与人数
┌─────────────────────────────────┐
│  成人 (4岁以上)                  │
│  ¥298/人                        │
│  [ - ]     2     [ + ]          │
├─────────────────────────────────┤
│  儿童 (4岁以下)                  │
│  ¥238/人                        │
│  [ - ]     0     [ + ]          │
├─────────────────────────────────┤
│  合计：2 人                      │
└─────────────────────────────────┘
```

#### 14.2.4 住宿信息改为备注

**变更说明：**
取消酒店下拉选择功能，改为自由文本输入（住宿备注）。

**变更原因：**
- 客户住宿地点多样，无法穷举所有酒店
- 部分客户住在民宿、朋友家等非标准住宿
- 自由输入更灵活，信息更准确

**字段定义：**
```
住宿备注（选填）
┌─────────────────────────────────┐
│ 请填写您的住宿地点（酒店名称、  │
│ 地址等），方便我们安排接送      │
│                                 │
│ 例如：二道白河喆啡酒店801房     │
└─────────────────────────────────┘
```

**后端处理：**
- 存储到 `Booking.accommodationNotes` 字段（新增）
- 原 `hotelName` 和 `hotelId` 字段保留但不再必填
- 运营可在后台根据备注手动关联住宿地点（如需要接送调度）

#### 14.2.5 价格计算逻辑

**定价策略：**
| 类型 | 价格 | 说明 |
|------|------|------|
| 成人 (4岁以上) | ¥298/人 | 标准价格 |
| 儿童 (4岁以下) | ¥238/人 | 儿童优惠价 |

**计算公式：**
```javascript
function calculateTotal(adultCount, childCount, packageInfo, visitDate) {
  let adultPrice = 298;  // 默认成人价
  let childPrice = 238;  // 默认儿童价

  // 检查套餐是否有自定义价格
  if (packageInfo) {
    adultPrice = packageInfo.price || adultPrice;
    childPrice = packageInfo.childPrice || childPrice;
  }

  // 检查特殊日期价格
  if (packageInfo?.specialPricing) {
    const specialPrice = getSpecialPrice(visitDate, packageInfo.specialPricing);
    if (specialPrice) {
      adultPrice = specialPrice.price;
      childPrice = specialPrice.childPrice;
    }
  }

  return {
    adultCount,
    childCount,
    adultPrice,
    childPrice,
    adultTotal: adultCount * adultPrice,
    childTotal: childCount * childPrice,
    totalAmount: adultCount * adultPrice + childCount * childPrice
  };
}
```

**价格展示：**
```
💰 费用明细
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
成人  2人 × ¥298  =  ¥596
儿童  1人 × ¥238  =  ¥238
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
合计：¥834
```

#### 14.2.6 优化后表单页面设计

```
┌─────────────────────────────────────┐
│  🏔️ 长白山双溪森林营地              │
│     冬季活动预约                     │
├─────────────────────────────────────┤
│                                     │
│  👤 您的信息                        │
│  ┌─────────────────────────────┐   │
│  │ 姓名 *                       │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 手机号 *                     │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 微信号（选填）               │   │
│  └─────────────────────────────┘   │
│                                     │
│  👥 参与人数                        │
│  ┌─────────────────────────────┐   │
│  │ 成人(4岁以上) ¥298/人        │   │
│  │ [ - ]     2     [ + ]        │   │
│  ├─────────────────────────────┤   │
│  │ 儿童(4岁以下) ¥238/人        │   │
│  │ [ - ]     0     [ + ]        │   │
│  ├─────────────────────────────┤   │
│  │ 合计：2 人                    │   │
│  └─────────────────────────────┘   │
│                                     │
│  🏨 住宿信息（选填）                │
│  ┌─────────────────────────────┐   │
│  │ 例如：喆啡酒店801房          │   │
│  └─────────────────────────────┘   │
│                                     │
│  📅 选择日期 *                      │
│  ┌─────────────────────────────┐   │
│  │  2026年1月29日 (周四)    ▼  │   │
│  └─────────────────────────────┘   │
│                                     │
│  🎁 选择套餐 *                      │
│  ┌─────────────────────────────┐   │
│  │ ● 全天套餐 ¥298/人          │   │
│  │   含接送、午餐、全部活动      │   │
│  ├─────────────────────────────┤   │
│  │ ○ 半日套餐 ¥198/人          │   │
│  │   含接送、部分活动            │   │
│  └─────────────────────────────┘   │
│                                     │
│  📝 备注（选填）                    │
│  ┌─────────────────────────────┐   │
│  │ 其他特殊需求...              │   │
│  └─────────────────────────────┘   │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  💰 费用明细                        │
│  成人 2人 × ¥298 = ¥596            │
│  儿童 0人 × ¥238 = ¥0              │
│  ───────────────────────────────   │
│  合计：¥596                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │       ✓ 提交预约             │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

---

### 14.3 订单自助查询功能

#### 14.3.1 功能概述

客户提交预约后，可通过手机号自助查询订单/预约状态，无需联系客服。

**访问方式：**
- 公开页面，无需登录
- 路由：`/order-query` 或 `/my-orders`
- 支持微信内置浏览器访问

#### 14.3.2 查询流程

```
┌─────────────────────────────────────────────────────────┐
│                    输入手机号                            │
│              ┌─────────────────────┐                    │
│              │  138****3861        │                    │
│              └─────────────────────┘                    │
│              ┌─────────────────────┐                    │
│              │     查询订单         │                    │
│              └─────────────────────┘                    │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                  发送验证码(可选)                        │
│          为保护隐私，首次查询需验证手机号                 │
│                                                         │
│              验证码已发送至 138****3861                  │
│              ┌─────────────────────┐                    │
│              │  输入4位验证码       │                    │
│              └─────────────────────┘                    │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    订单列表                              │
│  ┌───────────────────────────────────────────────────┐  │
│  │ 📋 预约 BK20260129001                             │  │
│  │ 日期：2026-01-29                                  │  │
│  │ 人数：2人（成人2人）                              │  │
│  │ 套餐：全天套餐                                    │  │
│  │ 金额：¥596                                        │  │
│  │ 状态：🟡 待确认                                   │  │
│  │                              [查看详情]           │  │
│  └───────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────┐  │
│  │ 📋 订单 ORD20260115001                            │  │
│  │ 日期：2026-01-15                                  │  │
│  │ 人数：4人（成人3人，儿童1人）                     │  │
│  │ 套餐：全天套餐                                    │  │
│  │ 金额：¥1132                                       │  │
│  │ 状态：🟢 已确认                                   │  │
│  │                              [查看详情]           │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

#### 14.3.3 订单详情页面

```
┌─────────────────────────────────────┐
│  ← 返回列表                          │
├─────────────────────────────────────┤
│                                     │
│  📋 预约详情                        │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  预约编号：BK20260129001            │
│  预约状态：🟡 待确认                │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  👤 预约人信息                      │
│  ───────────────────────────────   │
│  姓名：徐迅                         │
│  电话：138****3861                  │
│                                     │
│  📅 活动信息                        │
│  ───────────────────────────────   │
│  日期：2026-01-29（周四）           │
│  人数：2人（成人2人，儿童0人）      │
│  套餐：双溪森林营地全天套餐         │
│  住宿：喆啡酒店                     │
│                                     │
│  💰 费用明细                        │
│  ───────────────────────────────   │
│  成人 2人 × ¥298 = ¥596            │
│  儿童 0人 × ¥238 = ¥0              │
│  ───────────────────────────────   │
│  合计：¥596                         │
│  已付定金：¥0                       │
│  待付余款：¥596                     │
│                                     │
│  📍 接送安排                        │
│  ───────────────────────────────   │
│  上午9:00 酒店大堂集合              │
│  下午16:00 返回酒店                 │
│                                     │
│  ⚠️ 温馨提示                        │
│  ───────────────────────────────   │
│  • 请提前一天联系我们确认行程       │
│  • 活动当天请穿着保暖衣物           │
│  • 如需取消请提前24小时联系         │
│                                     │
│  📞 联系客服：138-xxxx-xxxx         │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  状态说明                           │
│  🟡 待确认 - 已提交，等待工作人员确认│
│  🟢 已确认 - 预约已确认，请按时参加  │
│  🔵 已完成 - 活动已结束             │
│  ⚪ 已取消 - 预约已取消             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │       返回预约首页           │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

#### 14.3.4 状态展示说明

| 状态 | 图标 | 说明 | 客户操作 |
|------|------|------|----------|
| pending | 🟡 | 待确认 | 等待工作人员确认 |
| confirmed | 🟢 | 已确认 | 按时参加活动 |
| converted | 🔵 | 已转订单 | 订单已生成 |
| completed | ✅ | 已完成 | 活动结束 |
| cancelled | ⚪ | 已取消 | 可重新预约 |

#### 14.3.5 API设计

**查询订单列表（公开API）**
```
POST /api/public/orders/query

Request:
{
  "phone": "13821213861",
  "verificationCode": "1234"  // 可选，首次需要验证
}

Response:
{
  "success": true,
  "data": {
    "bookings": [
      {
        "id": 1,
        "bookingCode": "BK20260129001",
        "visitDate": "2026-01-29",
        "peopleCount": 2,
        "childCount": 0,
        "packageName": "全天套餐",
        "totalAmount": 596,
        "status": "pending",
        "createdAt": "2026-01-28T10:00:00Z"
      }
    ],
    "orders": [
      {
        "id": 1,
        "orderNumber": "ORD20260115001",
        "visitDate": "2026-01-15",
        "peopleCount": 4,
        "packageName": "全天套餐",
        "totalAmount": 1132,
        "status": "confirmed",
        "createdAt": "2026-01-10T10:00:00Z"
      }
    ]
  }
}
```

**获取订单详情（公开API）**
```
GET /api/public/orders/:type/:id?phone=13821213861

参数：
- type: "booking" 或 "order"
- id: 预约ID或订单ID
- phone: 用于验证权限

Response:
{
  "success": true,
  "data": {
    "bookingCode": "BK20260129001",
    "customerName": "徐迅",
    "customerPhone": "138****3861",  // 脱敏显示
    "visitDate": "2026-01-29",
    "adultCount": 2,
    "childCount": 0,
    "packageName": "双溪森林营地全天套餐",
    "accommodationNotes": "喆啡酒店",
    "adultPrice": 298,
    "childPrice": 238,
    "totalAmount": 596,
    "depositAmount": 0,
    "status": "pending",
    "statusText": "待确认",
    "pickupInfo": {
      "time": "9:00",
      "location": "酒店大堂"
    }
  }
}
```

#### 14.3.6 安全考虑

| 风险 | 措施 |
|------|------|
| 手机号被他人查询 | 可选：首次查询需短信验证码验证 |
| 敏感信息泄露 | 手机号部分脱敏显示（138****3861） |
| 恶意批量查询 | 频率限制：同一IP每分钟最多10次查询 |
| 数据篡改 | 只提供查询功能，不提供修改接口 |

---

### 14.4 营地活动介绍页面

#### 14.4.1 功能概述

提供公开的营地活动介绍页面，让客户在预约前了解活动内容。

**特点：**
- 🔓 公开访问，无需登录
- 📱 移动端优先，支持微信内置浏览器
- 🔗 可作为微信小程序的H5页面嵌入
- 🎨 展示营地品牌形象

**访问路由：**
- `/activities` - 活动列表页
- `/activities/:id` - 活动详情页
- `/about` - 关于营地

#### 14.4.2 活动列表页面

```
┌─────────────────────────────────────┐
│  🏔️ 长白山双溪森林营地              │
│     冬季冰雪活动                     │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  [活动封面图]               │   │
│  │                             │   │
│  │  🎣 冰钓体验                │   │
│  │  专业教练指导，感受冰上垂钓  │   │
│  │  ⏱️ 2小时  👥 5-30人        │   │
│  │  💰 ¥128/人                 │   │
│  │                [了解更多 →] │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  [活动封面图]               │   │
│  │                             │   │
│  │  🔥 石板烧烤                │   │
│  │  长白山特色石板烤肉，鲜嫩多汁 │   │
│  │  ⏱️ 2小时  👥 10-50人       │   │
│  │  💰 ¥98/人                  │   │
│  │                [了解更多 →] │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  [活动封面图]               │   │
│  │                             │   │
│  │  ⛷️ 雪上滑梯乐园            │   │
│  │  多条滑道，适合全家欢乐      │   │
│  │  ⏱️ 1.5小时  👥 不限        │   │
│  │  💰 ¥68/人                  │   │
│  │                [了解更多 →] │   │
│  └─────────────────────────────┘   │
│                                     │
│  [更多活动...]                      │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  🎁 推荐套餐                        │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  ┌─────────────────────────────┐   │
│  │  全天套餐 ¥298/人           │   │
│  │  包含接送、午餐、全部活动    │   │
│  │              [立即预约 →]   │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │       📱 立即预约            │   │
│  └─────────────────────────────┘   │
│                                     │
│  📍 地址：长白山二道白河镇          │
│  📞 电话：138-xxxx-xxxx             │
│                                     │
└─────────────────────────────────────┘
```

#### 14.4.3 活动详情页面

```
┌─────────────────────────────────────┐
│  ← 返回                              │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │     [活动大图/轮播图]        │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  🎣 冰钓体验                        │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  📋 活动介绍                        │
│  ───────────────────────────────   │
│  在长白山的冰封湖面上，体验传统冰   │
│  钓的乐趣。专业教练全程指导，从凿   │
│  冰到垂钓，让您感受东北冬季特色。   │
│  钓上来的鱼可以现场烹饪品尝！       │
│                                     │
│  ✨ 活动亮点                        │
│  ───────────────────────────────   │
│  • 专业教练一对一指导               │
│  • 提供全套冰钓工具                 │
│  • 现场烹饪品尝                     │
│  • 体验传统凿冰技艺                 │
│                                     │
│  📝 活动信息                        │
│  ───────────────────────────────   │
│  ⏱️ 时长：2小时                     │
│  👥 人数：5-30人                    │
│  🗓️ 季节：冬季（12月-3月）          │
│  💰 价格：¥128/人                   │
│                                     │
│  ⚠️ 注意事项                        │
│  ───────────────────────────────   │
│  • 请穿着保暖防滑鞋                 │
│  • 建议戴手套和帽子                 │
│  • 活动需在教练指导下进行           │
│  • 不建议独自在冰面行走             │
│                                     │
│  📸 活动照片                        │
│  ───────────────────────────────   │
│  [图1] [图2] [图3] [图4]            │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │       📱 立即预约            │   │
│  │       ¥128/人               │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

#### 14.4.4 关于营地页面

```
┌─────────────────────────────────────┐
│  ← 返回                              │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │     [营地全景图/宣传视频]    │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  🏔️ 长白山双溪森林营地              │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  📍 关于我们                        │
│  ───────────────────────────────   │
│  双溪森林营地位于长白山二道白河镇   │
│  ，坐落于原始森林之中。我们提供独   │
│  特的冬季户外体验项目，让您感受东   │
│  北冰雪世界的魅力。                 │
│                                     │
│  🌟 营地特色                        │
│  ───────────────────────────────   │
│  • 原始森林环绕，空气清新           │
│  • 专业教练团队，安全保障           │
│  • 特色石板烧烤，美味可口           │
│  • 免费接送服务，贴心周到           │
│                                     │
│  🚌 交通指南                        │
│  ───────────────────────────────   │
│  • 二道白河镇内免费接送             │
│  • 长白山机场距离约1小时车程        │
│  • 可安排火车站接站服务             │
│                                     │
│  📞 联系我们                        │
│  ───────────────────────────────   │
│  电话：138-xxxx-xxxx                │
│  微信：changbaishan_camp            │
│  地址：吉林省长白山二道白河镇       │
│                                     │
│  🕐 营业时间                        │
│  ───────────────────────────────   │
│  冬季（12月-3月）：8:00-17:00       │
│  夏季（6月-9月）：7:00-18:00        │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │       📱 立即预约            │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

#### 14.4.5 数据来源

活动介绍内容从现有 `projects` 表读取，需扩展以下字段：

```prisma
model Project {
  // ... 现有字段 ...

  // V2.2 新增：活动介绍扩展字段
  coverImage    String?   @map("cover_image")     // 封面图URL
  images        String?   @map("images")          // 图片列表(JSON)
  highlights    String?   @map("highlights")      // 亮点(JSON数组)
  precautions   String?   @map("precautions")     // 注意事项(JSON数组)
  longDescription String? @map("long_description") // 详细介绍
  showInPublic  Boolean   @default(true) @map("show_in_public") // 是否公开展示
}
```

#### 14.4.6 API设计

**获取公开活动列表**
```
GET /api/public/activities

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "冰钓体验",
      "description": "专业教练指导，感受冰上垂钓",
      "coverImage": "/images/activities/ice-fishing.jpg",
      "price": 128,
      "duration": 120,
      "capacity": 30,
      "season": "winter"
    }
  ]
}
```

**获取活动详情**
```
GET /api/public/activities/:id

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "name": "冰钓体验",
    "description": "专业教练指导，感受冰上垂钓",
    "longDescription": "在长白山的冰封湖面上...",
    "coverImage": "/images/activities/ice-fishing.jpg",
    "images": ["/img1.jpg", "/img2.jpg"],
    "price": 128,
    "duration": 120,
    "capacity": 30,
    "season": "winter",
    "highlights": ["专业教练", "提供工具", "现场烹饪"],
    "precautions": ["穿保暖鞋", "戴手套"]
  }
}
```

#### 14.4.7 微信小程序对接

**对接方式：**
活动介绍页面设计为响应式H5页面，可通过以下方式对接微信小程序：

1. **Web-View嵌入**
   ```javascript
   // 小程序页面
   <web-view src="https://your-domain.com/activities"></web-view>
   ```

2. **分享配置**
   ```html
   <!-- 微信分享元数据 -->
   <meta property="og:title" content="长白山双溪森林营地 - 冬季活动" />
   <meta property="og:description" content="冰钓、石板烧烤、雪上滑梯..." />
   <meta property="og:image" content="/images/share-cover.jpg" />
   ```

3. **微信登录预留**
   - 页面预留微信登录入口
   - 后续可对接微信小程序用户体系
   - 实现一键授权登录功能

---

### 14.5 数据库变更

#### 14.5.1 修改 Booking 表

```prisma
model Booking {
  // ... 现有字段 ...

  // V2.2 修改：人数字段
  adultCount      Int       @default(1) @map("adult_count")    // 成人人数（原peopleCount拆分）
  childCount      Int       @default(0) @map("child_count")    // 儿童人数
  // peopleCount  Int       -- 废弃，改用 adultCount + childCount 计算

  // V2.2 新增：住宿备注
  accommodationNotes String? @map("accommodation_notes")       // 住宿备注（替代hotelName选择）
}
```

#### 14.5.2 扩展 Project 表

```prisma
model Project {
  // ... 现有字段 ...

  // V2.2 新增：活动介绍扩展
  coverImage      String?   @map("cover_image")
  images          String?   @map("images")           // JSON数组
  highlights      String?   @map("highlights")       // JSON数组
  precautions     String?   @map("precautions")      // JSON数组
  longDescription String?   @map("long_description")
  showInPublic    Boolean   @default(true) @map("show_in_public")
}
```

---

### 14.6 前端路由配置

```javascript
// App.js 路由配置 V2.2
<Routes>
  {/* 公开路由 - 无需登录 */}
  <Route path="/book" element={<PublicBookingForm />} />
  <Route path="/booking/success/:code" element={<BookingSuccess />} />

  {/* V2.2 新增：订单查询 */}
  <Route path="/my-orders" element={<OrderQuery />} />
  <Route path="/my-orders/:type/:id" element={<OrderDetail />} />

  {/* V2.2 新增：活动介绍 */}
  <Route path="/activities" element={<ActivityList />} />
  <Route path="/activities/:id" element={<ActivityDetail />} />
  <Route path="/about" element={<AboutCamp />} />

  {/* 登录路由 */}
  <Route path="/login" element={<Login />} />

  {/* 受保护路由 - 需要登录 */}
  <Route path="/bookings" element={<PrivateRoute><BookingList /></PrivateRoute>} />
  {/* ... 其他管理后台路由 */}
</Routes>
```

---

### 14.7 验收标准

| 验收项 | 标准 |
|--------|------|
| 表单布局 | 字段顺序为：姓名→手机号→微信号→人数→住宿备注→日期→套餐→备注 |
| 人数选择 | 成人和儿童数量独立控制，互不影响 |
| 价格计算 | 成人298元/人，儿童238元/人，计算正确 |
| 住宿备注 | 改为文本输入，替代下拉选择 |
| 订单查询 | 客户输入手机号可查看自己的预约/订单 |
| 订单详情 | 显示完整预约信息和状态说明 |
| 活动列表 | 展示所有公开活动，包含封面图、价格、时长 |
| 活动详情 | 展示详细介绍、亮点、注意事项、图片 |
| 移动适配 | 所有公开页面在微信内置浏览器中显示正常 |
| 数据安全 | 手机号脱敏显示，防止信息泄露 |

---

### 14.8 开发任务清单

**Phase 1：表单优化（优先级 P0）**
- [ ] 调整表单字段顺序
- [ ] 修复人数选择器Bug（独立adultCount/childCount）
- [ ] 将酒店选择改为住宿备注文本框
- [ ] 更新价格计算逻辑
- [ ] 更新后端API支持新字段
- [ ] 数据库迁移（新增accommodationNotes字段）

**Phase 2：订单查询（优先级 P1）**
- [ ] 创建订单查询页面
- [ ] 实现手机号查询API
- [ ] 创建订单详情页面
- [ ] 添加状态展示和说明
- [ ] 手机号脱敏处理

**Phase 3：活动介绍（优先级 P2）**
- [ ] 扩展Project表字段
- [ ] 创建活动列表公开API
- [ ] 创建活动列表页面
- [ ] 创建活动详情页面
- [ ] 创建关于营地页面
- [ ] 添加微信分享元数据

---

## 15. 技术架构

### 14.1 技术栈

**前端**
```
React 18.x + Tailwind CSS + React Router v6
Zustand(状态) + Axios(HTTP) + Recharts(图表)
date-fns + React Hook Form + Zod
```

**后端**
```
Node.js 18.x + Express.js
Prisma(ORM) + SQLite(开发)/PostgreSQL(生产)
JWT + bcrypt
```

### 14.2 目录结构

```
camp-management-system/
├── frontend/
│   ├── src/
│   │   ├── components/    # 组件
│   │   ├── pages/         # 页面
│   │   ├── api/           # API调用
│   │   └── App.jsx
│   └── package.json
│
├── backend/
│   ├── prisma/
│   │   └── schema.prisma  # 数据库Schema
│   ├── src/
│   │   ├── routes/        # 路由
│   │   ├── controllers/   # 控制器
│   │   └── server.js
│   └── package.json
│
├── PRODUCT_REQUIREMENTS.md  # 本文档
├── PRD_PART2.md             # 完整数据库Schema和附录
├── PROJECT_PLAN.md          # 项目计划
├── TODO.md                  # 开发清单
└── DATABASE_DESIGN.md       # 数据库设计
```

### 14.3 API设计示例

```javascript
// GET /api/customers - 获取客户列表
{
  "success": true,
  "data": {
    "customers": [...],
    "total": 100,
    "page": 1,
    "pageSize": 20
  }
}

// POST /api/orders - 创建订单
Request: {
  "customerId": 1,
  "accommodationPlaceId": 2,
  "visitDate": "2026-01-15",
  "peopleCount": 4,
  "projectIds": [1, 3],
  "packageId": null
}

Response: {
  "success": true,
  "data": {
    "orderNumber": "ORD202601090001",
    "totalAmount": 480
  }
}
```

---

## 15. 开发计划

### 15.1 时间线

```
Week 1-2  │ ████████████░░░░░░░░ │ MVP (40%)
          │ - 认证 + 客户 + 订单
          
Week 3-4  │ ████████████████░░░░ │ 核心功能 (80%)
          │ - 住宿 + 接送 + 套餐 + 基础排期
          
Week 5-6  │ ████████████████████ │ 完整版 (100%)
          │ - 完整排期 + 统计 + 内容
          
Week 7-9  │ ░░░░░░░░░░░░░░░░░░░░ │ 移动端 (可选)
          │ - 司机端 + 教练端 App
```

### 15.2 里程碑

| 里程碑 | 日期 | 交付内容 |
|-------|------|---------|
| 🎯 M1: MVP | Week 2 | 基础管理功能可用 |
| 🎯 M2: 核心功能 | Week 4 | 接送调度完整 |
| 🎯 M3: 生产就绪 | Week 6 | 可上线使用 |
| 🎯 M4: 移动端 | Week 9 | 移动App完成 |

### 15.3 今日任务 (Day 1)

- [ ] 安装 Node.js 18.x
- [ ] 安装 Git 和 VS Code
- [ ] 创建项目目录
- [ ] 初始化前后端项目
- [ ] 安装依赖包
- [ ] 设计数据库Schema
- [ ] 配置Prisma

**预计耗时**: 2-3小时

---

## 📊 开发进度追踪

### 当前进度

| 模块 | 状态 | 完成度 | 备注 |
|------|------|--------|------|
| 环境搭建 | ✅ | 100% | 已完成PRD |
| 用户认证 | ⏳ | 0% | - |
| 客户管理 | ⏳ | 0% | - |
| 订单管理 | ⏳ | 0% | - |
| 住宿管理 | ⏳ | 0% | - |
| 接送调度 | ⏳ | 0% | - |
| 套餐管理 | ⏳ | 0% | - |
| 行程排期 | ⏳ | 0% | - |
| 内容管理 | ⏳ | 0% | - |
| 统计分析 | ⏳ | 0% | - |
| **客户自助预约** | ⏳ | 0% | V2.1新增 |
| **预约表单优化** | ⏳ | 0% | V2.2新增 |
| **订单自助查询** | ⏳ | 0% | V2.2新增 |
| **营地活动介绍** | ⏳ | 0% | V2.2新增 |
| **套餐自定义管理** | ⏳ | 0% | V2.3新增 |
| **多媒体内容管理** | ⏳ | 0% | V2.3新增 |
| **套餐对比功能** | ⏳ | 0% | V2.3新增 |

**图例**: ⏳待开发 | 🚧开发中 | ✅已完成 | ⚠️需优化

---

## 15. 活动展示自定义与套餐管理模块 ⭐V2.3新增

### 15.1 模块概述

#### 需求背景

V2.2版本提供了基础的活动介绍页面，但运营反馈以下需求：

1. **套餐自定义能力不足**：无法灵活配置套餐内容、组合方式和展示样式
2. **缺少多媒体展示**：活动介绍仅支持图片，缺少视频介绍功能
3. **后台管理功能弱**：无法通过后台便捷管理活动展示内容
4. **套餐展示不够吸引**：缺少套餐详情页、对比展示等功能

#### 目标

- ✅ 运营可通过后台自定义套餐内容、价格、展示图片/视频
- ✅ 支持多媒体（图片+视频）介绍活动和套餐
- ✅ 提供套餐对比功能，帮助客户选择
- ✅ 灵活配置活动展示页面内容
- ✅ 支持拖拽排序，自定义展示顺序

---

### 15.2 套餐自定义管理

#### 15.2.1 功能概述

运营可在后台完整管理套餐信息，包括：
- 创建、编辑、删除套餐
- 配置套餐包含的活动项目
- 设置价格策略（普通价、儿童价、节假日价）
- 上传套餐封面图和介绍图片/视频
- 设置套餐展示顺序和状态

#### 15.2.2 套餐数据模型

```prisma
model Package {
  id              Int       @id @default(autoincrement())
  name            String                                    // 套餐名称
  subtitle        String?   @map("subtitle")               // 副标题
  description     String?                                   // 简短描述
  longDescription String?   @map("long_description")       // 详细介绍

  // 价格配置
  price           Decimal   @db.Decimal(10, 2)             // 成人价格
  childPrice      Decimal?  @map("child_price") @db.Decimal(10, 2)  // 儿童价格
  originalPrice   Decimal?  @map("original_price") @db.Decimal(10, 2) // 原价（划线价）
  specialPricing  String?   @map("special_pricing")        // 特殊日期价格(JSON)

  // 多媒体内容
  coverImage      String?   @map("cover_image")            // 封面图URL
  images          String?   @map("images")                 // 图片列表(JSON数组)
  videos          String?   @map("videos")                 // 视频列表(JSON数组)

  // 套餐内容
  includedItems   String?   @map("included_items")         // 包含项目(JSON数组)
  highlights      String?   @map("highlights")             // 套餐亮点(JSON数组)
  schedule        String?   @map("schedule")               // 行程安排(JSON数组)
  precautions     String?   @map("precautions")            // 注意事项(JSON数组)

  // 展示配置
  showInPublic    Boolean   @default(true) @map("show_in_public")      // 是否公开展示
  showInBooking   Boolean   @default(true) @map("show_in_booking")     // 是否在预约表单显示
  displayOrder    Int       @default(0) @map("display_order")          // 展示顺序
  badge           String?   @map("badge")                              // 标签(推荐/热门/新品)

  // 时间和容量
  duration        Int?      @map("duration")               // 活动时长(分钟)
  minPeople       Int       @default(1) @map("min_people") // 最少人数
  maxPeople       Int       @default(50) @map("max_people")// 最多人数

  // 状态
  status          String    @default("active")             // active/inactive/draft

  // 关联
  projectIds      String?   @map("project_ids")            // 包含的项目ID(JSON数组)

  // 时间戳
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@index([status, showInPublic])
  @@index([displayOrder])
  @@map("packages")
}
```

#### 15.2.3 套餐后台管理页面

**套餐列表页面（/packages）：**

```
┌──────────────────────────────────────────────────────────────────┐
│  套餐管理                                            [+ 创建套餐] │
├──────────────────────────────────────────────────────────────────┤
│  筛选: [全部状态 ▼] [搜索套餐名称]                        [搜索] │
├──────────────────────────────────────────────────────────────────┤
│  ☰ 封面      套餐名称              价格      状态    展示   操作  │
├──────────────────────────────────────────────────────────────────┤
│  ☰ [图]     全天套餐 ⭐推荐         ¥298     🟢上架   ✅✅   [编辑][预览] │
│  ☰ [图]     半日套餐               ¥198     🟢上架   ✅✅   [编辑][预览] │
│  ☰ [图]     冰雪乐园套餐           ¥168     🟡草稿   ❌❌   [编辑][预览] │
│  ☰ [图]     亲子套餐 🆕新品         ¥358     🟢上架   ✅✅   [编辑][预览] │
├──────────────────────────────────────────────────────────────────┤
│  💡 提示：拖动 ☰ 可调整套餐展示顺序              共 4 条 < 1/1 > │
└──────────────────────────────────────────────────────────────────┘

状态图例：🟢上架  🟡草稿  ⚪下架
展示列：✅公开展示 ✅预约表单显示
```

**套餐编辑页面：**

```
┌─────────────────────────────────────────────────────────────────────┐
│  ← 返回列表                                      [保存草稿] [发布]  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  基本信息                                                           │
│  ───────────────────────────────────────────────────────────────    │
│  套餐名称 *     ┌─────────────────────────────────────┐             │
│                 │ 双溪森林营地全天套餐                 │             │
│                 └─────────────────────────────────────┘             │
│  副标题         ┌─────────────────────────────────────┐             │
│                 │ 含接送、午餐、全部冰雪活动          │             │
│                 └─────────────────────────────────────┘             │
│  简短描述       ┌─────────────────────────────────────┐             │
│                 │ 一站式冰雪体验，畅玩一整天          │             │
│                 └─────────────────────────────────────┘             │
│  标签           [推荐 ▼]  [热门] [新品] [限时] [无]                │
│                                                                     │
│  价格设置                                                           │
│  ───────────────────────────────────────────────────────────────    │
│  成人价格 *     ┌────────┐    儿童价格     ┌────────┐              │
│  (4岁以上)      │ 298    │    (4岁以下)    │ 238    │              │
│                 └────────┘                 └────────┘              │
│  原价(划线价)   ┌────────┐    展示为 ¥298 ~~¥398~~                 │
│                 │ 398    │                                          │
│                 └────────┘                                          │
│                                                                     │
│  [+ 添加特殊日期价格]                                               │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 春节档期  2026-01-30 ~ 2026-02-03   成人¥358  儿童¥298  [×] │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  多媒体内容                                                         │
│  ───────────────────────────────────────────────────────────────    │
│  封面图片 *     ┌─────────────────────────────────────┐             │
│                 │  📷 点击上传或拖拽图片到这里         │             │
│                 │     建议尺寸：750x500               │             │
│                 └─────────────────────────────────────┘             │
│                                                                     │
│  介绍图片       [图1 ×] [图2 ×] [图3 ×] [+ 添加]                   │
│  (最多10张)     💡 可拖拽调整顺序                                   │
│                                                                     │
│  介绍视频       ┌─────────────────────────────────────┐             │
│                 │  🎬 点击上传视频或输入视频链接       │             │
│                 │     支持：MP4、腾讯视频、B站链接     │             │
│                 └─────────────────────────────────────┘             │
│                 [视频1 ×]  [+ 添加视频]                              │
│                                                                     │
│  套餐内容                                                           │
│  ───────────────────────────────────────────────────────────────    │
│  包含项目       [✓ 冰钓体验] [✓ 石板烧烤] [✓ 雪上滑梯]             │
│                 [✓ 森林徒步] [  烤棉花糖] [  烤地瓜]                │
│                                                                     │
│  套餐亮点       ┌─────────────────────────────────────┐             │
│                 │ 1. 专业教练全程陪同                  │             │
│                 │ 2. 二道白河镇免费接送                │             │
│                 │ 3. 包含特色石板午餐                  │             │
│                 │ [+ 添加亮点]                         │             │
│                 └─────────────────────────────────────┘             │
│                                                                     │
│  行程安排       ┌─────────────────────────────────────┐             │
│                 │ 09:00  酒店接送出发                  │             │
│                 │ 10:00  冰钓体验                      │             │
│                 │ 12:00  石板烧烤午餐                  │             │
│                 │ 14:00  雪上滑梯乐园                  │             │
│                 │ 16:00  返回酒店                      │             │
│                 │ [+ 添加行程]                         │             │
│                 └─────────────────────────────────────┘             │
│                                                                     │
│  注意事项       ┌─────────────────────────────────────┐             │
│                 │ • 请穿着保暖防滑鞋                   │             │
│                 │ • 活动需在教练指导下进行             │             │
│                 │ • 4岁以下儿童需家长陪同              │             │
│                 │ [+ 添加事项]                         │             │
│                 └─────────────────────────────────────┘             │
│                                                                     │
│  详细介绍       ┌─────────────────────────────────────┐             │
│  (富文本)       │                                     │             │
│                 │  [B] [I] [图] [链接] [列表]          │             │
│                 │  ─────────────────────────────────  │             │
│                 │  在长白山的冰封世界中，体验一站式   │             │
│                 │  冰雪乐趣。专业教练带队，安全有保   │             │
│                 │  障。包含冰钓、石板烧烤、雪上滑梯   │             │
│                 │  等丰富活动，让您畅玩一整天...      │             │
│                 └─────────────────────────────────────┘             │
│                                                                     │
│  展示设置                                                           │
│  ───────────────────────────────────────────────────────────────    │
│  [✓] 公开展示（在活动页面显示此套餐）                               │
│  [✓] 预约表单显示（客户可在预约时选择此套餐）                       │
│  活动时长       ┌─────┐ 小时                                        │
│                 │  7  │                                              │
│                 └─────┘                                              │
│  人数限制       最少 ┌───┐ 人   最多 ┌────┐ 人                     │
│                      │ 1 │          │ 50 │                          │
│                      └───┘          └────┘                          │
│                                                                     │
│  ───────────────────────────────────────────────────────────────    │
│                                         [保存草稿]   [发布套餐]     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 15.3 活动项目多媒体管理

#### 15.3.1 功能概述

扩展现有项目管理功能，支持：
- 上传活动封面图和介绍图片
- 上传或链接介绍视频
- 配置活动详情展示内容
- 设置公开展示状态和顺序

#### 15.3.2 项目数据模型扩展

```prisma
model Project {
  // ... 现有字段 ...

  // V2.3 新增：多媒体内容
  coverImage      String?   @map("cover_image")            // 封面图URL
  images          String?   @map("images")                 // 图片列表(JSON)
  videos          String?   @map("videos")                 // 视频列表(JSON)

  // V2.3 新增：详细内容
  longDescription String?   @map("long_description")       // 详细介绍
  highlights      String?   @map("highlights")             // 活动亮点(JSON)
  precautions     String?   @map("precautions")            // 注意事项(JSON)

  // V2.3 新增：展示配置
  showInPublic    Boolean   @default(true) @map("show_in_public")
  displayOrder    Int       @default(0) @map("display_order")
  badge           String?   @map("badge")                  // 热门/推荐/新品
}
```

#### 15.3.3 视频内容配置

**支持的视频类型：**

| 类型 | 说明 | 存储格式 |
|------|------|----------|
| 本地上传 | 上传MP4视频到服务器 | {"type": "upload", "url": "/uploads/videos/xxx.mp4"} |
| 腾讯视频 | 嵌入腾讯视频链接 | {"type": "tencent", "vid": "xxx"} |
| B站视频 | 嵌入B站视频链接 | {"type": "bilibili", "bvid": "BVxxx"} |
| YouTube | 嵌入YouTube链接 | {"type": "youtube", "vid": "xxx"} |

**视频展示组件：**

```javascript
// 视频播放器组件
const VideoPlayer = ({ video }) => {
  switch (video.type) {
    case 'upload':
      return <video src={video.url} controls />;
    case 'tencent':
      return <iframe src={`https://v.qq.com/txp/iframe/player.html?vid=${video.vid}`} />;
    case 'bilibili':
      return <iframe src={`https://player.bilibili.com/player.html?bvid=${video.bvid}`} />;
    default:
      return null;
  }
};
```

---

### 15.4 公开展示页面优化

#### 15.4.1 套餐展示页面

**套餐列表页（/packages）：**

```
┌─────────────────────────────────────────────────────────────────┐
│  🏔️ 长白山双溪森林营地                                          │
│     精选活动套餐                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │  [套餐封面大图/视频]                                       │ │
│  │                                              ⭐ 推荐       │ │
│  │                                                           │ │
│  ├───────────────────────────────────────────────────────────┤ │
│  │  🎁 全天套餐                                              │ │
│  │  含接送、午餐、全部冰雪活动                                │ │
│  │                                                           │ │
│  │  💰 ¥298/人  ~~¥398~~        👶 儿童 ¥238/人             │ │
│  │                                                           │ │
│  │  ✓ 冰钓体验  ✓ 石板烧烤  ✓ 雪上滑梯  ✓ 森林徒步         │ │
│  │                                                           │ │
│  │  ⏱️ 全天(7小时)    👥 1-50人                              │ │
│  │                                                           │ │
│  │  ┌─────────────────┐  ┌─────────────────┐                │ │
│  │  │   查看详情 →    │  │   立即预约 →    │                │ │
│  │  └─────────────────┘  └─────────────────┘                │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │  [套餐封面图]                                🆕 新品       │ │
│  ├───────────────────────────────────────────────────────────┤ │
│  │  🎁 亲子套餐                                              │ │
│  │  专为亲子家庭设计，安全有趣                                │ │
│  │                                                           │ │
│  │  💰 ¥358/人                  👶 儿童 ¥258/人             │ │
│  │  ...                                                      │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  📊 套餐对比                                                    │
│  ───────────────────────────────────────────────────────────    │
│  │ 项目        │ 全天套餐 │ 半日套餐 │ 亲子套餐 │               │
│  │─────────────│──────────│──────────│──────────│               │
│  │ 价格        │ ¥298     │ ¥198     │ ¥358     │               │
│  │ 时长        │ 7小时    │ 4小时    │ 6小时    │               │
│  │ 冰钓        │ ✅       │ ❌       │ ✅       │               │
│  │ 石板烧烤    │ ✅       │ ✅       │ ✅       │               │
│  │ 雪上滑梯    │ ✅       │ ✅       │ ✅       │               │
│  │ 森林徒步    │ ✅       │ ❌       │ ✅       │               │
│  │ 亲子活动    │ ❌       │ ❌       │ ✅       │               │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                                                 │
│  📞 咨询热线：138-xxxx-xxxx                                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**套餐详情页（/packages/:id）：**

```
┌─────────────────────────────────────────────────────────────────┐
│  ← 返回                                                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │     [轮播图/视频播放器]                                    │ │
│  │     ● ○ ○ ○ ○  (图片指示器)                               │ │
│  │     ▶ 观看介绍视频                                        │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  🎁 双溪森林营地全天套餐                          ⭐ 推荐       │
│  含接送、午餐、全部冰雪活动                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                                                 │
│  💰 价格                                                        │
│  ───────────────────────────────────────────────────────────    │
│  成人 (4岁以上)：¥298/人   ~~¥398~~                            │
│  儿童 (4岁以下)：¥238/人                                        │
│  ⚠️ 春节档期(1/30-2/3)：成人¥358 儿童¥298                      │
│                                                                 │
│  📋 套餐内容                                                    │
│  ───────────────────────────────────────────────────────────    │
│  ✅ 二道白河镇免费接送                                          │
│  ✅ 冰钓体验（2小时，专业教练指导）                             │
│  ✅ 石板烧烤午餐（长白山特色）                                  │
│  ✅ 雪上滑梯乐园（不限时）                                      │
│  ✅ 森林轻徒步（赏雾凇）                                        │
│  ✅ 烤棉花糖、热饮等                                            │
│                                                                 │
│  ✨ 套餐亮点                                                    │
│  ───────────────────────────────────────────────────────────    │
│  🏔️ 专业教练全程陪同，安全有保障                                │
│  🚌 二道白河镇内免费酒店接送                                    │
│  🍖 包含正宗长白山石板烧烤午餐                                  │
│  ❄️ 体验原始冰钓，可现场烹饪品尝                                │
│                                                                 │
│  📅 行程安排                                                    │
│  ───────────────────────────────────────────────────────────    │
│  09:00  📍 酒店大堂集合，出发前往营地                           │
│  10:00  🎣 冰钓体验，专业教练指导                               │
│  12:00  🍖 石板烧烤午餐，品尝长白山特色美食                     │
│  14:00  ⛷️ 雪上滑梯乐园，畅玩冰雪世界                           │
│  15:30  🌲 森林轻徒步，欣赏雾凇美景                             │
│  16:00  🚌 返回酒店，结束愉快行程                               │
│                                                                 │
│  📸 活动精彩瞬间                                                │
│  ───────────────────────────────────────────────────────────    │
│  [图1] [图2] [图3] [图4] [图5]                                  │
│  (点击查看大图)                                                 │
│                                                                 │
│  🎬 视频介绍                                                    │
│  ───────────────────────────────────────────────────────────    │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                    [视频播放器]                            │ │
│  │                         ▶                                 │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ⚠️ 温馨提示                                                    │
│  ───────────────────────────────────────────────────────────    │
│  • 请穿着保暖防滑鞋，建议戴手套和帽子                           │
│  • 4岁以下儿童需家长全程陪同                                    │
│  • 活动需在教练指导下进行，请勿独自行动                         │
│  • 如有特殊饮食需求请提前告知                                   │
│                                                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                    📱 立即预约                             │ │
│  │                   ¥298/人 起                              │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  📞 咨询热线：138-xxxx-xxxx（郑长岭）                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

### 15.5 文件上传功能

#### 15.5.1 图片上传

**支持格式：** JPG, PNG, WebP, GIF
**大小限制：** 单张最大 5MB
**自动处理：**
- 自动压缩大图
- 生成缩略图
- 图片CDN加速（可选）

**API设计：**
```
POST /api/upload/image
Content-Type: multipart/form-data

Request:
- file: 图片文件
- type: cover / gallery / avatar
- resize: true/false (是否压缩)

Response:
{
  "success": true,
  "data": {
    "url": "/uploads/images/2026/01/xxx.jpg",
    "thumbnail": "/uploads/images/2026/01/xxx_thumb.jpg",
    "width": 1200,
    "height": 800
  }
}
```

#### 15.5.2 视频上传

**支持格式：** MP4, MOV
**大小限制：** 单个最大 100MB
**替代方案：** 支持输入第三方视频链接

**API设计：**
```
POST /api/upload/video
Content-Type: multipart/form-data

Request:
- file: 视频文件

Response:
{
  "success": true,
  "data": {
    "url": "/uploads/videos/2026/01/xxx.mp4",
    "duration": 120,
    "thumbnail": "/uploads/videos/2026/01/xxx_thumb.jpg"
  }
}
```

---

### 15.6 API设计

#### 15.6.1 套餐管理API（需认证）

**获取套餐列表**
```
GET /api/packages?status=active&page=1&pageSize=20

Response:
{
  "success": true,
  "data": {
    "items": [...],
    "total": 10,
    "page": 1
  }
}
```

**获取套餐详情**
```
GET /api/packages/:id
```

**创建套餐**
```
POST /api/packages

Request:
{
  "name": "全天套餐",
  "subtitle": "含接送、午餐、全部活动",
  "price": 298,
  "childPrice": 238,
  "coverImage": "/uploads/xxx.jpg",
  "images": ["/img1.jpg", "/img2.jpg"],
  "videos": [{"type": "upload", "url": "/videos/xxx.mp4"}],
  "highlights": ["专业教练", "免费接送"],
  "schedule": [{"time": "09:00", "content": "酒店出发"}],
  "showInPublic": true
}
```

**更新套餐**
```
PUT /api/packages/:id
```

**删除套餐**
```
DELETE /api/packages/:id
```

**更新套餐排序**
```
PUT /api/packages/reorder

Request:
{
  "orders": [
    { "id": 1, "displayOrder": 0 },
    { "id": 2, "displayOrder": 1 }
  ]
}
```

#### 15.6.2 公开API（无需认证）

**获取公开套餐列表**
```
GET /api/public/packages

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "全天套餐",
      "subtitle": "含接送、午餐、全部活动",
      "price": 298,
      "childPrice": 238,
      "originalPrice": 398,
      "coverImage": "/uploads/xxx.jpg",
      "badge": "推荐",
      "duration": 420,
      "includedItems": ["冰钓", "石板烧烤", "雪上滑梯"],
      "highlights": ["专业教练", "免费接送"]
    }
  ]
}
```

**获取公开套餐详情**
```
GET /api/public/packages/:id

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "name": "全天套餐",
    "subtitle": "...",
    "description": "...",
    "longDescription": "...",
    "price": 298,
    "childPrice": 238,
    "originalPrice": 398,
    "specialPricing": {...},
    "coverImage": "...",
    "images": [...],
    "videos": [...],
    "highlights": [...],
    "schedule": [...],
    "precautions": [...],
    "duration": 420,
    "minPeople": 1,
    "maxPeople": 50
  }
}
```

---

### 15.7 前端路由配置

```javascript
// App.js V2.3 路由配置
<Routes>
  {/* 公开路由 */}
  <Route path="/packages" element={<PublicPackageList />} />
  <Route path="/packages/:id" element={<PublicPackageDetail />} />
  <Route path="/activities" element={<ActivityList />} />
  <Route path="/activities/:id" element={<ActivityDetail />} />
  <Route path="/book" element={<PublicBookingForm />} />
  <Route path="/my-orders" element={<OrderQuery />} />
  <Route path="/about" element={<AboutCamp />} />

  {/* 管理后台路由 */}
  <Route path="/admin/packages" element={<PrivateRoute><PackageManage /></PrivateRoute>} />
  <Route path="/admin/packages/create" element={<PrivateRoute><PackageEdit /></PrivateRoute>} />
  <Route path="/admin/packages/:id/edit" element={<PrivateRoute><PackageEdit /></PrivateRoute>} />
  <Route path="/admin/projects" element={<PrivateRoute><ProjectManage /></PrivateRoute>} />
  {/* ... */}
</Routes>
```

---

### 15.8 数据库变更汇总

```prisma
// V2.3 Package 表完整定义
model Package {
  id              Int       @id @default(autoincrement())
  name            String
  subtitle        String?   @map("subtitle")
  description     String?
  longDescription String?   @map("long_description")

  // 价格
  price           Decimal   @db.Decimal(10, 2)
  childPrice      Decimal?  @map("child_price") @db.Decimal(10, 2)
  originalPrice   Decimal?  @map("original_price") @db.Decimal(10, 2)
  specialPricing  String?   @map("special_pricing")

  // 多媒体
  coverImage      String?   @map("cover_image")
  images          String?   @map("images")
  videos          String?   @map("videos")

  // 内容
  includedItems   String?   @map("included_items")
  highlights      String?   @map("highlights")
  schedule        String?   @map("schedule")
  precautions     String?   @map("precautions")

  // 展示
  showInPublic    Boolean   @default(true) @map("show_in_public")
  showInBooking   Boolean   @default(true) @map("show_in_booking")
  displayOrder    Int       @default(0) @map("display_order")
  badge           String?   @map("badge")

  // 配置
  duration        Int?      @map("duration")
  minPeople       Int       @default(1) @map("min_people")
  maxPeople       Int       @default(50) @map("max_people")
  status          String    @default("active")
  projectIds      String?   @map("project_ids")

  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@index([status, showInPublic])
  @@index([displayOrder])
  @@map("packages")
}

// V2.3 Project 表扩展字段
model Project {
  // ... 现有字段 ...

  // V2.3 新增
  coverImage      String?   @map("cover_image")
  images          String?   @map("images")
  videos          String?   @map("videos")
  longDescription String?   @map("long_description")
  highlights      String?   @map("highlights")
  precautions     String?   @map("precautions")
  showInPublic    Boolean   @default(true) @map("show_in_public")
  displayOrder    Int       @default(0) @map("display_order")
  badge           String?   @map("badge")
}
```

---

### 15.9 验收标准

| 验收项 | 标准 |
|--------|------|
| 套餐创建 | 运营可在后台创建、编辑、删除套餐 |
| 图片上传 | 支持上传封面图和多张介绍图片 |
| 视频支持 | 支持上传视频或输入第三方视频链接 |
| 内容配置 | 可配置套餐亮点、行程安排、注意事项 |
| 价格设置 | 支持成人价、儿童价、原价、特殊日期价 |
| 排序功能 | 支持拖拽调整套餐展示顺序 |
| 状态管理 | 支持上架/下架/草稿状态切换 |
| 公开展示 | 套餐列表页正确展示已上架套餐 |
| 套餐详情 | 详情页展示完整内容包括图片视频 |
| 套餐对比 | 提供套餐对比表格帮助客户选择 |
| 移动适配 | 所有页面在移动端显示正常 |
| 预约关联 | 预约表单正确显示可选套餐 |

---

### 15.10 开发任务清单

**Phase 1：后台管理（优先级 P0）**
- [ ] 扩展Package表数据结构
- [ ] 创建套餐管理后台页面
- [ ] 实现套餐CRUD API
- [ ] 实现图片上传功能
- [ ] 实现视频上传/链接功能
- [ ] 实现拖拽排序功能

**Phase 2：公开展示（优先级 P1）**
- [ ] 创建套餐列表公开页面
- [ ] 创建套餐详情公开页面
- [ ] 实现套餐对比功能
- [ ] 实现图片轮播组件
- [ ] 实现视频播放组件
- [ ] 优化移动端展示

**Phase 3：活动项目扩展（优先级 P2）**
- [ ] 扩展Project表多媒体字段
- [ ] 更新项目管理页面
- [ ] 优化活动详情展示
- [ ] 实现活动视频介绍

---

## 🚀 快速开始

### 1. 环境准备

```bash
# 1. 安装Node.js (https://nodejs.org)
node -v  # 验证: v18.x+

# 2. 安装Git
git --version

# 3. 克隆项目
git clone <your-repo>
cd camp-management-system
```

### 2. 后端启动

```bash
cd backend
npm install
cp .env.example .env  # 配置环境变量
npx prisma migrate dev --name init
npx prisma generate
npm run dev  # 启动: http://localhost:3000
```

### 3. 前端启动

```bash
cd frontend
npm install
npm run dev  # 启动: http://localhost:5173
```

### 4. 数据库管理

```bash
npx prisma studio  # 打开: http://localhost:5555
```

---

## 📝 更新日志

**2026-01-14 - V2.3**
- 🎁 **套餐自定义管理**
  - 运营可在后台完整管理套餐：创建、编辑、删除
  - 支持配置价格策略：成人价、儿童价、原价（划线价）、特殊日期价
  - 支持配置套餐内容：包含项目、亮点、行程安排、注意事项
  - 支持上架/下架/草稿状态管理
- 📷 **多媒体内容支持**
  - 套餐和活动支持上传封面图和多张介绍图片
  - 支持本地上传视频或嵌入第三方视频链接（腾讯视频、B站）
  - 图片轮播展示，视频播放器组件
- 📊 **套餐对比功能**
  - 套餐列表页提供对比表格
  - 帮助客户快速比较不同套餐的内容和价格
- ↕️ **拖拽排序功能**
  - 支持拖拽调整套餐和活动的展示顺序
  - 灵活控制前端展示优先级
- 🖼️ **公开展示页面优化**
  - 套餐列表页展示封面图、价格、包含项目
  - 套餐详情页展示完整信息包括图片视频轮播
  - 所有页面适配移动端显示

**2026-01-14 - V2.2**
- 🔧 **预约表单优化**
  - 调整表单字段顺序：姓名→手机号→微信号→人数→住宿备注→日期→套餐→备注
  - 修复人数选择器Bug：成人和儿童独立计数，互不影响
  - 取消酒店下拉选择，改为住宿备注文本输入
  - 定价策略明确：成人298元/人，儿童(4岁以下)238元/人
- 📋 **订单自助查询**
  - 客户可通过手机号查看自己的预约/订单状态
  - 支持查看订单详情、费用明细、接送安排
  - 手机号脱敏显示，保护隐私
- 🏕️ **营地活动介绍页面**
  - 公开活动列表页面，展示所有营地活动
  - 活动详情页面，包含介绍、亮点、注意事项、图片
  - 关于营地页面，展示营地信息和联系方式
  - 支持微信小程序Web-View嵌入，预留微信登录接口

**2026-01-09 - V2.0**
- ✅ 完成产品需求文档
- ✅ 新增4大核心模块(住宿/接送/套餐/排期)
- ✅ 完成数据库设计
- ✅ 制定开发计划

---

## 📞 联系方式

- **产品负责人**: [待填写]
- **技术负责人**: [待填写]
- **营地负责人**: [待填写]

---

**继续阅读**: 
- 📄 [Part 2: 完整数据库Schema和附录](./PRD_PART2.md)
- 📋 [开发任务清单](./TODO.md)
- 🗂️ [数据库设计详细文档](./DATABASE_DESIGN.md)
- 📅 [项目计划](./PROJECT_PLAN.md)

**文档状态**: ✅ 已完成 | 📅 最后更新: 2026-01-14 (V2.3)
